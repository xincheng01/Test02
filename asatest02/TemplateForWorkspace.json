{
	"$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
	"contentVersion": "1.0.0.0",
	"parameters": {
		"workspaceName": {
			"type": "string",
			"metadata": "Workspace name",
			"defaultValue": "asatest02"
		},
		"AzureSynapseAnalytics1_connectionString": {
			"type": "secureString",
			"metadata": "Secure string for 'connectionString' of 'AzureSynapseAnalytics1'"
		},
		"asatest02-WorkspaceDefaultSqlServer_connectionString": {
			"type": "secureString",
			"metadata": "Secure string for 'connectionString' of 'asatest02-WorkspaceDefaultSqlServer'"
		},
		"asatest02-WorkspaceDefaultStorage_properties_typeProperties_url": {
			"type": "string",
			"defaultValue": "https://adltest02.dfs.core.windows.net"
		}
	},
	"variables": {
		"workspaceId": "[concat('Microsoft.Synapse/workspaces/', parameters('workspaceName'))]"
	},
	"resources": [
		{
			"name": "[concat(parameters('workspaceName'), '/dwtest01')]",
			"type": "Microsoft.Synapse/workspaces/sqlPools",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"annotations": []
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('workspaceName'), '/Pipeline 1')]",
			"type": "Microsoft.Synapse/workspaces/pipelines",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"activities": [
					{
						"name": "Data flow1",
						"type": "ExecuteDataFlow",
						"dependsOn": [],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "UpdateCustomerDimension",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"SourceDB": {},
									"DimCustomerSCD": {},
									"sink": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					}
				],
				"annotations": [],
				"lastPublishTime": "2021-05-10T02:28:14Z"
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/dataflows/UpdateCustomerDimension')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/Spark pool01')]",
			"type": "Microsoft.Synapse/workspaces/pipelines",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"activities": [
					{
						"name": "Notebook NYC Taxi",
						"type": "SynapseNotebook",
						"dependsOn": [],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"notebook": {
								"referenceName": "Notebook NYC Taxi",
								"type": "NotebookReference"
							},
							"snapshot": true
						}
					}
				],
				"annotations": []
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/notebooks/Notebook NYC Taxi')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/CustomerSource')]",
			"type": "Microsoft.Synapse/workspaces/datasets",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"linkedServiceName": {
					"referenceName": "AzureSynapseAnalytics1",
					"type": "LinkedServiceReference"
				},
				"annotations": [],
				"type": "AzureSqlDWTable",
				"schema": [
					{
						"name": "CustomerID",
						"type": "int",
						"precision": 10
					},
					{
						"name": "Title",
						"type": "nvarchar"
					},
					{
						"name": "FirstName",
						"type": "nvarchar"
					},
					{
						"name": "MiddleName",
						"type": "nvarchar"
					},
					{
						"name": "LastName",
						"type": "nvarchar"
					},
					{
						"name": "Suffix",
						"type": "nvarchar"
					},
					{
						"name": "CompanyName",
						"type": "nvarchar"
					},
					{
						"name": "SalesPerson",
						"type": "nvarchar"
					},
					{
						"name": "EmailAddress",
						"type": "nvarchar"
					},
					{
						"name": "Phone",
						"type": "nvarchar"
					}
				],
				"typeProperties": {
					"schema": "dbo",
					"table": "CustomerSource"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/AzureSynapseAnalytics1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/DimCustomer')]",
			"type": "Microsoft.Synapse/workspaces/datasets",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"linkedServiceName": {
					"referenceName": "AzureSynapseAnalytics1",
					"type": "LinkedServiceReference"
				},
				"annotations": [],
				"type": "AzureSqlDWTable",
				"schema": [
					{
						"name": "CustomerID",
						"type": "int",
						"precision": 10
					},
					{
						"name": "Title",
						"type": "nvarchar"
					},
					{
						"name": "FirstName",
						"type": "nvarchar"
					},
					{
						"name": "MiddleName",
						"type": "nvarchar"
					},
					{
						"name": "LastName",
						"type": "nvarchar"
					},
					{
						"name": "Suffix",
						"type": "nvarchar"
					},
					{
						"name": "CompanyName",
						"type": "nvarchar"
					},
					{
						"name": "SalesPerson",
						"type": "nvarchar"
					},
					{
						"name": "EmailAddress",
						"type": "nvarchar"
					},
					{
						"name": "Phone",
						"type": "nvarchar"
					},
					{
						"name": "InsertedDate",
						"type": "datetime",
						"precision": 23,
						"scale": 3
					},
					{
						"name": "ModifiedDate",
						"type": "datetime",
						"precision": 23,
						"scale": 3
					},
					{
						"name": "HashKey",
						"type": "char"
					}
				],
				"typeProperties": {
					"schema": "dbo",
					"table": "DimCustomer_SCD"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/AzureSynapseAnalytics1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/AzureSynapseAnalytics1')]",
			"type": "Microsoft.Synapse/workspaces/linkedServices",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"annotations": [],
				"type": "AzureSqlDW",
				"typeProperties": {
					"connectionString": "[parameters('AzureSynapseAnalytics1_connectionString')]"
				},
				"connectVia": {
					"referenceName": "AutoResolveIntegrationRuntime",
					"type": "IntegrationRuntimeReference"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/integrationRuntimes/AutoResolveIntegrationRuntime')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/asatest02-WorkspaceDefaultSqlServer')]",
			"type": "Microsoft.Synapse/workspaces/linkedServices",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"parameters": {
					"DBName": {
						"type": "String"
					}
				},
				"annotations": [],
				"type": "AzureSqlDW",
				"typeProperties": {
					"connectionString": "[parameters('asatest02-WorkspaceDefaultSqlServer_connectionString')]"
				},
				"connectVia": {
					"referenceName": "AutoResolveIntegrationRuntime",
					"type": "IntegrationRuntimeReference"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/integrationRuntimes/AutoResolveIntegrationRuntime')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/asatest02-WorkspaceDefaultStorage')]",
			"type": "Microsoft.Synapse/workspaces/linkedServices",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"annotations": [],
				"type": "AzureBlobFS",
				"typeProperties": {
					"url": "[parameters('asatest02-WorkspaceDefaultStorage_properties_typeProperties_url')]"
				},
				"connectVia": {
					"referenceName": "AutoResolveIntegrationRuntime",
					"type": "IntegrationRuntimeReference"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/integrationRuntimes/AutoResolveIntegrationRuntime')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/AutoResolveIntegrationRuntime')]",
			"type": "Microsoft.Synapse/workspaces/integrationRuntimes",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "Managed",
				"typeProperties": {
					"computeProperties": {
						"location": "AutoResolve",
						"dataFlowProperties": {
							"computeType": "General",
							"coreCount": 8,
							"timeToLive": 0
						}
					}
				}
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('workspaceName'), '/UpdateCustomerDimension')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"dataset": {
								"referenceName": "CustomerSource",
								"type": "DatasetReference"
							},
							"name": "SourceDB"
						},
						{
							"dataset": {
								"referenceName": "DimCustomer",
								"type": "DatasetReference"
							},
							"name": "DimCustomerSCD"
						}
					],
					"sinks": [
						{
							"dataset": {
								"referenceName": "DimCustomer",
								"type": "DatasetReference"
							},
							"name": "sink"
						}
					],
					"transformations": [
						{
							"name": "CreateCustomerHash"
						},
						{
							"name": "Exists"
						},
						{
							"name": "LookupCustomerID"
						},
						{
							"name": "SetDates"
						},
						{
							"name": "AllowUpserts"
						}
					],
					"script": "source(output(\n\t\tCustomerID as integer,\n\t\tTitle as string,\n\t\tFirstName as string,\n\t\tMiddleName as string,\n\t\tLastName as string,\n\t\tSuffix as string,\n\t\tCompanyName as string,\n\t\tSalesPerson as string,\n\t\tEmailAddress as string,\n\t\tPhone as string\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tisolationLevel: 'READ_UNCOMMITTED',\n\tformat: 'table',\n\tstaged: false) ~> SourceDB\nsource(output(\n\t\tCustomerID as integer,\n\t\tTitle as string,\n\t\tFirstName as string,\n\t\tMiddleName as string,\n\t\tLastName as string,\n\t\tSuffix as string,\n\t\tCompanyName as string,\n\t\tSalesPerson as string,\n\t\tEmailAddress as string,\n\t\tPhone as string,\n\t\tInsertedDate as timestamp,\n\t\tModifiedDate as timestamp,\n\t\tHashKey as string\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tisolationLevel: 'READ_UNCOMMITTED',\n\tformat: 'table',\n\tstaged: false) ~> DimCustomerSCD\nSourceDB derive(HashKey = sha2(256, iifNull(Title,'') +FirstName +iifNull(MiddleName,'') +LastName +iifNull(Suffix,'') +iifNull(CompanyName,'') +iifNull(SalesPerson,'') +iifNull(EmailAddress,'') +iifNull(Phone,''))) ~> CreateCustomerHash\nCreateCustomerHash, DimCustomerSCD exists(CreateCustomerHash@HashKey == DimCustomerSCD@HashKey,\n\tnegate:true,\n\tbroadcast: 'auto')~> Exists\nExists, DimCustomerSCD lookup(SourceDB@CustomerID == DimCustomerSCD@CustomerID,\n\tmultiple: false,\n\tpickup: 'any',\n\tbroadcast: 'auto')~> LookupCustomerID\nLookupCustomerID derive(InsertedDate = iif(isNull(InsertedDate), currentTimestamp(), InsertedDate),\n\t\tModifiedDate = currentTimestamp()) ~> SetDates\nSetDates alterRow(upsertIf(true())) ~> AllowUpserts\nAllowUpserts sink(input(\n\t\tCustomerID as integer,\n\t\tTitle as string,\n\t\tFirstName as string,\n\t\tMiddleName as string,\n\t\tLastName as string,\n\t\tSuffix as string,\n\t\tCompanyName as string,\n\t\tSalesPerson as string,\n\t\tEmailAddress as string,\n\t\tPhone as string,\n\t\tInsertedDate as timestamp,\n\t\tModifiedDate as timestamp,\n\t\tHashKey as string\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tdeletable:false,\n\tinsertable:true,\n\tupdateable:false,\n\tupsertable:true,\n\tkeys:['CustomerID'],\n\tformat: 'table',\n\tstaged: false,\n\tmapColumn(\n\t\tCustomerID = SourceDB@CustomerID,\n\t\tTitle = SourceDB@Title,\n\t\tFirstName = SourceDB@FirstName,\n\t\tMiddleName = SourceDB@MiddleName,\n\t\tLastName = SourceDB@LastName,\n\t\tSuffix = SourceDB@Suffix,\n\t\tCompanyName = SourceDB@CompanyName,\n\t\tSalesPerson = SourceDB@SalesPerson,\n\t\tEmailAddress = SourceDB@EmailAddress,\n\t\tPhone = SourceDB@Phone,\n\t\tInsertedDate,\n\t\tModifiedDate,\n\t\tHashKey = CreateCustomerHash@HashKey\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> sink"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/datasets/CustomerSource')]",
				"[concat(variables('workspaceId'), '/datasets/DimCustomer')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/WorkspaceSystemIdentity')]",
			"type": "Microsoft.Synapse/workspaces/credentials",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "ManagedIdentity",
				"typeProperties": {}
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('workspaceName'), '/Load data to Azure Synapse Analytics SQL pool')]",
			"type": "Microsoft.Synapse/workspaces/sqlscripts",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"content": {
					"query": "--Load data to Azure Synapse Analytics SQL pool\n\n  --1.In the query window, enter these T-SQL commands to create a login and user named LoaderRC60\nUSE MASTER; \nGO\nCREATE LOGIN LoaderRC60 WITH PASSWORD = 'Test12345';\nCREATE USER LoaderRC60 FOR LOGIN LoaderRC60;\n\n  --2.Enter the following T-SQL commands to create a database user named LoaderRC60 for the LoaderRC60 login. The second line grants the new user CONTROL permissions on the new data warehouse. These permissions are similar to making the user the owner of the database. The third line adds the new user as a member of the staticrc60\nUSE DWTEST01;\nGO\nCREATE USER LoaderRC60 FOR LOGIN LoaderRC60;\nGRANT CONTROL ON DATABASE::[dwtest01] to LoaderRC60;\nEXEC sp_addrolemember 'staticrc60', 'LoaderRC60';\n\n\n  --3.Create a master key for the SampleDW database. You only need to create a master key once per database.\nCREATE MASTER KEY;\n\n  --4. CREATE EXTERNAL DATA SOURCE\nCREATE EXTERNAL DATA SOURCE WWIStorage\nWITH\n(\n    TYPE = Hadoop,\n    LOCATION = 'wasbs://wideworldimporters@sqldwholdata.blob.core.windows.net'\n);\n\n  --5. Run the following CREATE EXTERNAL FILE FORMAT T-SQL statement to specify the formatting characteristics and options for the external data file.\nCREATE EXTERNAL FILE FORMAT TextFileFormat\nWITH\n(\n    FORMAT_TYPE = DELIMITEDTEXT,\n    FORMAT_OPTIONS\n    (\n        FIELD_TERMINATOR = '|',\n        USE_TYPE_DEFAULT = FALSE\n    )\n);\n\n  --6.Run the following CREATE SCHEMA statements to create a schema for your external file format. The ext schema provides a way to organize the external tables you are about to create. The wwi schema organizes the standard tables that will contain the data.\nCREATE SCHEMA ext;\nGO\nCREATE SCHEMA wwi;\nGO\n\n\n  --7. Create the external tables. \nCREATE EXTERNAL TABLE [ext].[dimension_City](\n    [City Key] [int] NOT NULL,\n    [WWI City ID] [int] NOT NULL,\n    [City] [nvarchar](50) NOT NULL,\n    [State Province] [nvarchar](50) NOT NULL,\n    [Country] [nvarchar](60) NOT NULL,\n    [Continent] [nvarchar](30) NOT NULL,\n    [Sales Territory] [nvarchar](50) NOT NULL,\n    [Region] [nvarchar](30) NOT NULL,\n    [Subregion] [nvarchar](30) NOT NULL,\n    [Location] [nvarchar](76) NULL,\n    [Latest Recorded Population] [bigint] NOT NULL,\n    [Valid From] [datetime2](7) NOT NULL,\n    [Valid To] [datetime2](7) NOT NULL,\n    [Lineage Key] [int] NOT NULL\n)\nWITH (LOCATION='/v1/dimension_City/',\n    DATA_SOURCE = WWIStorage,  \n    FILE_FORMAT = TextFileFormat,\n    REJECT_TYPE = VALUE,\n    REJECT_VALUE = 0\n);  \n\nCREATE EXTERNAL TABLE [ext].[dimension_Customer] (\n    [Customer Key] [int] NOT NULL,\n    [WWI Customer ID] [int] NOT NULL,\n    [Customer] [nvarchar](100) NOT NULL,\n    [Bill To Customer] [nvarchar](100) NOT NULL,\n       [Category] [nvarchar](50) NOT NULL,\n    [Buying Group] [nvarchar](50) NOT NULL,\n    [Primary Contact] [nvarchar](50) NOT NULL,\n    [Postal Code] [nvarchar](10) NOT NULL,\n    [Valid From] [datetime2](7) NOT NULL,\n    [Valid To] [datetime2](7) NOT NULL,\n    [Lineage Key] [int] NOT NULL\n)\nWITH (LOCATION='/v1/dimension_Customer/',\n    DATA_SOURCE = WWIStorage,  \n    FILE_FORMAT = TextFileFormat,\n    REJECT_TYPE = VALUE,\n    REJECT_VALUE = 0\n);  \n\nCREATE EXTERNAL TABLE [ext].[dimension_Employee] (\n    [Employee Key] [int] NOT NULL,\n    [WWI Employee ID] [int] NOT NULL,\n    [Employee] [nvarchar](50) NOT NULL,\n    [Preferred Name] [nvarchar](50) NOT NULL,\n    [Is Salesperson] [bit] NOT NULL,\n    [Photo] [varbinary](300) NULL,\n    [Valid From] [datetime2](7) NOT NULL,\n    [Valid To] [datetime2](7) NOT NULL,\n    [Lineage Key] [int] NOT NULL\n)\nWITH ( LOCATION='/v1/dimension_Employee/',\n    DATA_SOURCE = WWIStorage,  \n    FILE_FORMAT = TextFileFormat,\n    REJECT_TYPE = VALUE,\n    REJECT_VALUE = 0\n);\n\nCREATE EXTERNAL TABLE [ext].[dimension_PaymentMethod] (\n    [Payment Method Key] [int] NOT NULL,\n    [WWI Payment Method ID] [int] NOT NULL,\n    [Payment Method] [nvarchar](50) NOT NULL,\n    [Valid From] [datetime2](7) NOT NULL,\n    [Valid To] [datetime2](7) NOT NULL,\n    [Lineage Key] [int] NOT NULL\n)\nWITH ( LOCATION ='/v1/dimension_PaymentMethod/',\n    DATA_SOURCE = WWIStorage,  \n    FILE_FORMAT = TextFileFormat,\n    REJECT_TYPE = VALUE,\n    REJECT_VALUE = 0\n);\n\nCREATE EXTERNAL TABLE [ext].[dimension_StockItem](\n    [Stock Item Key] [int] NOT NULL,\n    [WWI Stock Item ID] [int] NOT NULL,\n    [Stock Item] [nvarchar](100) NOT NULL,\n    [Color] [nvarchar](20) NOT NULL,\n    [Selling Package] [nvarchar](50) NOT NULL,\n    [Buying Package] [nvarchar](50) NOT NULL,\n    [Brand] [nvarchar](50) NOT NULL,\n    [Size] [nvarchar](20) NOT NULL,\n    [Lead Time Days] [int] NOT NULL,\n    [Quantity Per Outer] [int] NOT NULL,\n    [Is Chiller Stock] [bit] NOT NULL,\n    [Barcode] [nvarchar](50) NULL,\n    [Tax Rate] [decimal](18, 3) NOT NULL,\n    [Unit Price] [decimal](18, 2) NOT NULL,\n    [Recommended Retail Price] [decimal](18, 2) NULL,\n    [Typical Weight Per Unit] [decimal](18, 3) NOT NULL,\n    [Photo] [varbinary](300) NULL,\n    [Valid From] [datetime2](7) NOT NULL,\n    [Valid To] [datetime2](7) NOT NULL,\n    [Lineage Key] [int] NOT NULL\n)\nWITH ( LOCATION ='/v1/dimension_StockItem/',\n    DATA_SOURCE = WWIStorage,  \n    FILE_FORMAT = TextFileFormat,\n    REJECT_TYPE = VALUE,\n    REJECT_VALUE = 0\n);\n\nCREATE EXTERNAL TABLE [ext].[dimension_Supplier](\n    [Supplier Key] [int] NOT NULL,\n    [WWI Supplier ID] [int] NOT NULL,\n    [Supplier] [nvarchar](100) NOT NULL,\n    [Category] [nvarchar](50) NOT NULL,\n    [Primary Contact] [nvarchar](50) NOT NULL,\n    [Supplier Reference] [nvarchar](20) NULL,\n    [Payment Days] [int] NOT NULL,\n    [Postal Code] [nvarchar](10) NOT NULL,\n    [Valid From] [datetime2](7) NOT NULL,\n    [Valid To] [datetime2](7) NOT NULL,\n    [Lineage Key] [int] NOT NULL\n)\nWITH ( LOCATION ='/v1/dimension_Supplier/',\n    DATA_SOURCE = WWIStorage,  \n    FILE_FORMAT = TextFileFormat,\n    REJECT_TYPE = VALUE,\n    REJECT_VALUE = 0\n);\n\nCREATE EXTERNAL TABLE [ext].[dimension_TransactionType](\n    [Transaction Type Key] [int] NOT NULL,\n    [WWI Transaction Type ID] [int] NOT NULL,\n    [Transaction Type] [nvarchar](50) NOT NULL,\n    [Valid From] [datetime2](7) NOT NULL,\n    [Valid To] [datetime2](7) NOT NULL,\n    [Lineage Key] [int] NOT NULL\n)\nWITH ( LOCATION ='/v1/dimension_TransactionType/',\n    DATA_SOURCE = WWIStorage,  \n    FILE_FORMAT = TextFileFormat,\n    REJECT_TYPE = VALUE,\n    REJECT_VALUE = 0\n);\n\nCREATE EXTERNAL TABLE [ext].[fact_Movement] (\n    [Movement Key] [bigint] NOT NULL,\n    [Date Key] [date] NOT NULL,\n    [Stock Item Key] [int] NOT NULL,\n    [Customer Key] [int] NULL,\n    [Supplier Key] [int] NULL,\n    [Transaction Type Key] [int] NOT NULL,\n    [WWI Stock Item Transaction ID] [int] NOT NULL,\n    [WWI Invoice ID] [int] NULL,\n    [WWI Purchase Order ID] [int] NULL,\n    [Quantity] [int] NOT NULL,\n    [Lineage Key] [int] NOT NULL\n)\nWITH ( LOCATION ='/v1/fact_Movement/',\n    DATA_SOURCE = WWIStorage,  \n    FILE_FORMAT = TextFileFormat,\n    REJECT_TYPE = VALUE,\n    REJECT_VALUE = 0\n);\n\nCREATE EXTERNAL TABLE [ext].[fact_Order] (\n    [Order Key] [bigint] NOT NULL,\n    [City Key] [int] NOT NULL,\n    [Customer Key] [int] NOT NULL,\n    [Stock Item Key] [int] NOT NULL,\n    [Order Date Key] [date] NOT NULL,\n    [Picked Date Key] [date] NULL,\n    [Salesperson Key] [int] NOT NULL,\n    [Picker Key] [int] NULL,\n    [WWI Order ID] [int] NOT NULL,\n    [WWI Backorder ID] [int] NULL,\n    [Description] [nvarchar](100) NOT NULL,\n    [Package] [nvarchar](50) NOT NULL,\n    [Quantity] [int] NOT NULL,\n    [Unit Price] [decimal](18, 2) NOT NULL,\n    [Tax Rate] [decimal](18, 3) NOT NULL,\n    [Total Excluding Tax] [decimal](18, 2) NOT NULL,\n    [Tax Amount] [decimal](18, 2) NOT NULL,\n    [Total Including Tax] [decimal](18, 2) NOT NULL,\n    [Lineage Key] [int] NOT NULL\n)\nWITH ( LOCATION ='/v1/fact_Order/',\n    DATA_SOURCE = WWIStorage,\n    FILE_FORMAT = TextFileFormat,\n    REJECT_TYPE = VALUE,\n    REJECT_VALUE = 0\n);\n\nCREATE EXTERNAL TABLE [ext].[fact_Purchase] (\n    [Purchase Key] [bigint] NOT NULL,\n    [Date Key] [date] NOT NULL,\n    [Supplier Key] [int] NOT NULL,\n    [Stock Item Key] [int] NOT NULL,\n    [WWI Purchase Order ID] [int] NULL,\n    [Ordered Outers] [int] NOT NULL,\n    [Ordered Quantity] [int] NOT NULL,\n    [Received Outers] [int] NOT NULL,\n    [Package] [nvarchar](50) NOT NULL,\n    [Is Order Finalized] [bit] NOT NULL,\n    [Lineage Key] [int] NOT NULL\n)\nWITH ( LOCATION ='/v1/fact_Purchase/',\n    DATA_SOURCE = WWIStorage,  \n    FILE_FORMAT = TextFileFormat,\n    REJECT_TYPE = VALUE,\n    REJECT_VALUE = 0\n);\n\nCREATE EXTERNAL TABLE [ext].[fact_Sale] (\n    [Sale Key] [bigint] NOT NULL,\n    [City Key] [int] NOT NULL,\n    [Customer Key] [int] NOT NULL,\n    [Bill To Customer Key] [int] NOT NULL,\n    [Stock Item Key] [int] NOT NULL,\n    [Invoice Date Key] [date] NOT NULL,\n    [Delivery Date Key] [date] NULL,\n    [Salesperson Key] [int] NOT NULL,\n    [WWI Invoice ID] [int] NOT NULL,\n    [Description] [nvarchar](100) NOT NULL,\n    [Package] [nvarchar](50) NOT NULL,\n    [Quantity] [int] NOT NULL,\n    [Unit Price] [decimal](18, 2) NOT NULL,\n    [Tax Rate] [decimal](18, 3) NOT NULL,\n    [Total Excluding Tax] [decimal](18, 2) NOT NULL,\n    [Tax Amount] [decimal](18, 2) NOT NULL,\n    [Profit] [decimal](18, 2) NOT NULL,\n    [Total Including Tax] [decimal](18, 2) NOT NULL,\n    [Total Dry Items] [int] NOT NULL,\n    [Total Chiller Items] [int] NOT NULL,\n    [Lineage Key] [int] NOT NULL\n)\nWITH ( LOCATION ='/v1/fact_Sale/',\n    DATA_SOURCE = WWIStorage,  \n    FILE_FORMAT = TextFileFormat,\n    REJECT_TYPE = VALUE,\n    REJECT_VALUE = 0\n);\n\nCREATE EXTERNAL TABLE [ext].[fact_StockHolding] (\n    [Stock Holding Key] [bigint] NOT NULL,\n    [Stock Item Key] [int] NOT NULL,\n    [Quantity On Hand] [int] NOT NULL,\n    [Bin Location] [nvarchar](20) NOT NULL,\n    [Last Stocktake Quantity] [int] NOT NULL,\n    [Last Cost Price] [decimal](18, 2) NOT NULL,\n    [Reorder Level] [int] NOT NULL,\n    [Target Stock Level] [int] NOT NULL,\n    [Lineage Key] [int] NOT NULL\n)\nWITH ( LOCATION ='/v1/fact_StockHolding/',\n    DATA_SOURCE = WWIStorage,  \n    FILE_FORMAT = TextFileFormat,\n    REJECT_TYPE = VALUE,\n    REJECT_VALUE = 0\n);\n\nCREATE EXTERNAL TABLE [ext].[fact_Transaction] (\n    [Transaction Key] [bigint] NOT NULL,\n    [Date Key] [date] NOT NULL,\n    [Customer Key] [int] NULL,\n    [Bill To Customer Key] [int] NULL,\n    [Supplier Key] [int] NULL,\n    [Transaction Type Key] [int] NOT NULL,\n    [Payment Method Key] [int] NULL,\n    [WWI Customer Transaction ID] [int] NULL,\n    [WWI Supplier Transaction ID] [int] NULL,\n    [WWI Invoice ID] [int] NULL,\n    [WWI Purchase Order ID] [int] NULL,\n    [Supplier Invoice Number] [nvarchar](20) NULL,\n    [Total Excluding Tax] [decimal](18, 2) NOT NULL,\n    [Tax Amount] [decimal](18, 2) NOT NULL,\n    [Total Including Tax] [decimal](18, 2) NOT NULL,\n    [Outstanding Balance] [decimal](18, 2) NOT NULL,\n    [Is Finalized] [bit] NOT NULL,\n    [Lineage Key] [int] NOT NULL\n)\nWITH ( LOCATION ='/v1/fact_Transaction/',\n    DATA_SOURCE = WWIStorage,  \n    FILE_FORMAT = TextFileFormat,\n    REJECT_TYPE = VALUE,\n    REJECT_VALUE = 0\n);\n\n\n  --8. Run the following script to load the data into new tables in your data warehouse.\nCREATE TABLE [wwi].[dimension_City]\nWITH\n(\n    DISTRIBUTION = REPLICATE,\n    CLUSTERED COLUMNSTORE INDEX\n)\nAS\nSELECT * FROM [ext].[dimension_City]\nOPTION (LABEL = 'CTAS : Load [wwi].[dimension_City]')\n;\n\nCREATE TABLE [wwi].[dimension_Customer]\nWITH\n(\n    DISTRIBUTION = REPLICATE,\n    CLUSTERED COLUMNSTORE INDEX\n)\nAS\nSELECT * FROM [ext].[dimension_Customer]\nOPTION (LABEL = 'CTAS : Load [wwi].[dimension_Customer]')\n;\n\nCREATE TABLE [wwi].[dimension_Employee]\nWITH\n(\n    DISTRIBUTION = REPLICATE,\n    CLUSTERED COLUMNSTORE INDEX\n)\nAS\nSELECT * FROM [ext].[dimension_Employee]\nOPTION (LABEL = 'CTAS : Load [wwi].[dimension_Employee]')\n;\n\nCREATE TABLE [wwi].[dimension_PaymentMethod]\nWITH\n(\n    DISTRIBUTION = REPLICATE,\n    CLUSTERED COLUMNSTORE INDEX\n)\nAS\nSELECT * FROM [ext].[dimension_PaymentMethod]\nOPTION (LABEL = 'CTAS : Load [wwi].[dimension_PaymentMethod]')\n;\n\nCREATE TABLE [wwi].[dimension_StockItem]\nWITH\n(\n    DISTRIBUTION = REPLICATE,\n    CLUSTERED COLUMNSTORE INDEX\n)\nAS\nSELECT * FROM [ext].[dimension_StockItem]\nOPTION (LABEL = 'CTAS : Load [wwi].[dimension_StockItem]')\n;\n\nCREATE TABLE [wwi].[dimension_Supplier]\nWITH\n(\n    DISTRIBUTION = REPLICATE,\n    CLUSTERED COLUMNSTORE INDEX\n)\nAS\nSELECT * FROM [ext].[dimension_Supplier]\nOPTION (LABEL = 'CTAS : Load [wwi].[dimension_Supplier]')\n;\n\nCREATE TABLE [wwi].[dimension_TransactionType]\nWITH\n(\n    DISTRIBUTION = REPLICATE,\n    CLUSTERED COLUMNSTORE INDEX\n)\nAS\nSELECT * FROM [ext].[dimension_TransactionType]\nOPTION (LABEL = 'CTAS : Load [wwi].[dimension_TransactionType]')\n;\n\nCREATE TABLE [wwi].[fact_Movement]\nWITH\n(\n    DISTRIBUTION = HASH([Movement Key]),\n    CLUSTERED COLUMNSTORE INDEX\n)\nAS\nSELECT * FROM [ext].[fact_Movement]\nOPTION (LABEL = 'CTAS : Load [wwi].[fact_Movement]')\n;\n\nCREATE TABLE [wwi].[fact_Order]\nWITH\n(\n    DISTRIBUTION = HASH([Order Key]),\n    CLUSTERED COLUMNSTORE INDEX\n)\nAS\nSELECT * FROM [ext].[fact_Order]\nOPTION (LABEL = 'CTAS : Load [wwi].[fact_Order]')\n;\n\nCREATE TABLE [wwi].[fact_Purchase]\nWITH\n(\n    DISTRIBUTION = HASH([Purchase Key]),\n    CLUSTERED COLUMNSTORE INDEX\n)\nAS\nSELECT * FROM [ext].[fact_Purchase]\nOPTION (LABEL = 'CTAS : Load [wwi].[fact_Purchase]')\n;\n\n\nCREATE TABLE [wwi].[seed_Sale]\nWITH\n(\n    DISTRIBUTION = HASH([WWI Invoice ID]),\n    CLUSTERED COLUMNSTORE INDEX\n)\nAS\nSELECT * FROM [ext].[fact_Sale]\nOPTION (LABEL = 'CTAS : Load [wwi].[seed_Sale]')\n;\n\nCREATE TABLE [wwi].[fact_StockHolding]\nWITH\n(\n    DISTRIBUTION = HASH([Stock Holding Key]),\n    CLUSTERED COLUMNSTORE INDEX\n)\nAS\nSELECT * FROM [ext].[fact_StockHolding]\nOPTION (LABEL = 'CTAS : Load [wwi].[fact_StockHolding]')\n;\n\nCREATE TABLE [wwi].[fact_Transaction]\nWITH\n(\n    DISTRIBUTION = HASH([Transaction Key]),\n    CLUSTERED COLUMNSTORE INDEX\n)\nAS\nSELECT * FROM [ext].[fact_Transaction]\nOPTION (LABEL = 'CTAS : Load [wwi].[fact_Transaction]')\n;\n\nWITH A AS (\nSELECT [Sale Key]\n      ,[City Key]\n      ,[Customer Key]\n      ,[Bill To Customer Key]\n      ,[Stock Item Key]\n      ,[Invoice Date Key]\n      ,[Delivery Date Key]\n      ,[Salesperson Key]\n      ,[WWI Invoice ID]\n      ,[Description]\n      ,[Package]\n      ,[Quantity]\n      ,[Unit Price]\n      ,[Tax Rate]\n      ,[Total Excluding Tax]\n      ,[Tax Amount]\n      ,[Profit]\n      ,[Total Including Tax]\n      ,[Total Dry Items]\n      ,[Total Chiller Items]\n      ,[Lineage Key]\n\t  ,row_number() over(partition by [Invoice Date Key] order by [Total Including Tax] desc) as rn \n  FROM [wwi].[seed_Sale])\nSELECT [Sale Key]\n      ,[City Key]\n      ,[Customer Key]\n      ,[Bill To Customer Key]\n      ,[Stock Item Key]\n      ,[Invoice Date Key]\n      ,[Delivery Date Key]\n      ,[Salesperson Key]\n      ,[WWI Invoice ID]\n      ,[Description]\n      ,[Package]\n      ,[Quantity]\n      ,[Unit Price]\n      ,[Tax Rate]\n      ,[Total Excluding Tax]\n      ,[Tax Amount]\n      ,[Profit]\n      ,[Total Including Tax]\n      ,[Total Dry Items]\n      ,[Total Chiller Items]\n      ,[Lineage Key] \n   INTO [wwi].[seed_Sale_Small]\n   FROM A \n   WHERE A.rn <= 1000; \n\n\n  --9. query execution results\nSELECT\n    r.command,\n    s.request_id,\n    r.status,\n    count(distinct input_name) as nbr_files,\n    sum(s.bytes_processed)/1024/1024/1024 as gb_processed\nFROM\n    sys.dm_pdw_exec_requests r\n    INNER JOIN sys.dm_pdw_dms_external_work s\n    ON r.request_id = s.request_id\nWHERE\n    r.[label] = 'CTAS : Load [wwi].[dimension_City]' OR\n    r.[label] = 'CTAS : Load [wwi].[dimension_Customer]' OR\n    r.[label] = 'CTAS : Load [wwi].[dimension_Employee]' OR\n    r.[label] = 'CTAS : Load [wwi].[dimension_PaymentMethod]' OR\n    r.[label] = 'CTAS : Load [wwi].[dimension_StockItem]' OR\n    r.[label] = 'CTAS : Load [wwi].[dimension_Supplier]' OR\n    r.[label] = 'CTAS : Load [wwi].[dimension_TransactionType]' OR\n    r.[label] = 'CTAS : Load [wwi].[fact_Movement]' OR\n    r.[label] = 'CTAS : Load [wwi].[fact_Order]' OR\n    r.[label] = 'CTAS : Load [wwi].[fact_Purchase]' OR\n    r.[label] = 'CTAS : Load [wwi].[fact_StockHolding]' OR\n    r.[label] = 'CTAS : Load [wwi].[fact_Transaction]'\nGROUP BY\n    r.command,\n    s.request_id,\n    r.status\nORDER BY\n    nbr_files desc,\n    gb_processed desc;\n\n\n\n  --10.Create the dimension_Date and fact_Sale tables.\nCREATE TABLE [wwi].[dimension_Date]\n(\n    [Date] [datetime] NOT NULL,\n    [Day Number] [int] NOT NULL,\n    [Day] [nvarchar](10) NOT NULL,\n    [Month] [nvarchar](10) NOT NULL,\n    [Short Month] [nvarchar](3) NOT NULL,\n    [Calendar Month Number] [int] NOT NULL,\n    [Calendar Month Label] [nvarchar](20) NOT NULL,\n    [Calendar Year] [int] NOT NULL,\n    [Calendar Year Label] [nvarchar](10) NOT NULL,\n    [Fiscal Month Number] [int] NOT NULL,\n    [Fiscal Month Label] [nvarchar](20) NOT NULL,\n    [Fiscal Year] [int] NOT NULL,\n    [Fiscal Year Label] [nvarchar](10) NOT NULL,\n    [ISO Week Number] [int] NOT NULL\n)\nWITH\n(\n    DISTRIBUTION = REPLICATE,\n    CLUSTERED INDEX ([Date])\n);\n\nCREATE TABLE [wwi].[fact_Sale]\n(\n    [Sale Key] [bigint] IDENTITY(1,1) NOT NULL,\n    [City Key] [int] NOT NULL,\n    [Customer Key] [int] NOT NULL,\n    [Bill To Customer Key] [int] NOT NULL,\n    [Stock Item Key] [int] NOT NULL,\n    [Invoice Date Key] [date] NOT NULL,\n    [Delivery Date Key] [date] NULL,\n    [Salesperson Key] [int] NOT NULL,\n    [WWI Invoice ID] [int] NOT NULL,\n    [Description] [nvarchar](100) NOT NULL,\n    [Package] [nvarchar](50) NOT NULL,\n    [Quantity] [int] NOT NULL,\n    [Unit Price] [decimal](18, 2) NOT NULL,\n    [Tax Rate] [decimal](18, 3) NOT NULL,\n    [Total Excluding Tax] [decimal](18, 2) NOT NULL,\n    [Tax Amount] [decimal](18, 2) NOT NULL,\n    [Profit] [decimal](18, 2) NOT NULL,\n    [Total Including Tax] [decimal](18, 2) NOT NULL,\n    [Total Dry Items] [int] NOT NULL,\n    [Total Chiller Items] [int] NOT NULL,\n    [Lineage Key] [int] NOT NULL\n)\nWITH\n(\n    DISTRIBUTION = HASH ( [WWI Invoice ID] ),\n    CLUSTERED COLUMNSTORE INDEX\n);\n\n  --11.Create [wwi].[InitialSalesDataPopulation] to increase the number of rows in [wwi].[seed_Sale] by a factor of eight.\nCREATE PROCEDURE [wwi].[InitialSalesDataPopulation] AS\nBEGIN\n    INSERT INTO [wwi].[seed_Sale] (\n        [Sale Key], [City Key], [Customer Key], [Bill To Customer Key], [Stock Item Key], [Invoice Date Key], [Delivery Date Key], [Salesperson Key], [WWI Invoice ID], [Description], [Package], [Quantity], [Unit Price], [Tax Rate], [Total Excluding Tax], [Tax Amount], [Profit], [Total Including Tax], [Total Dry Items], [Total Chiller Items], [Lineage Key]\n    )\n    SELECT\n        [Sale Key], [City Key], [Customer Key], [Bill To Customer Key], [Stock Item Key], [Invoice Date Key], [Delivery Date Key], [Salesperson Key], [WWI Invoice ID], [Description], [Package], [Quantity], [Unit Price], [Tax Rate], [Total Excluding Tax], [Tax Amount], [Profit], [Total Including Tax], [Total Dry Items], [Total Chiller Items], [Lineage Key]\n    FROM [wwi].[seed_Sale]\n\n    INSERT INTO [wwi].[seed_Sale] (\n        [Sale Key], [City Key], [Customer Key], [Bill To Customer Key], [Stock Item Key], [Invoice Date Key], [Delivery Date Key], [Salesperson Key], [WWI Invoice ID], [Description], [Package], [Quantity], [Unit Price], [Tax Rate], [Total Excluding Tax], [Tax Amount], [Profit], [Total Including Tax], [Total Dry Items], [Total Chiller Items], [Lineage Key]\n    )\n    SELECT\n        [Sale Key], [City Key], [Customer Key], [Bill To Customer Key], [Stock Item Key], [Invoice Date Key], [Delivery Date Key], [Salesperson Key], [WWI Invoice ID], [Description], [Package], [Quantity], [Unit Price], [Tax Rate], [Total Excluding Tax], [Tax Amount], [Profit], [Total Including Tax], [Total Dry Items], [Total Chiller Items], [Lineage Key]\n    FROM [wwi].[seed_Sale]\n\n    INSERT INTO [wwi].[seed_Sale] (\n        [Sale Key], [City Key], [Customer Key], [Bill To Customer Key], [Stock Item Key], [Invoice Date Key], [Delivery Date Key], [Salesperson Key], [WWI Invoice ID], [Description], [Package], [Quantity], [Unit Price], [Tax Rate], [Total Excluding Tax], [Tax Amount], [Profit], [Total Including Tax], [Total Dry Items], [Total Chiller Items], [Lineage Key]\n    )\n    SELECT\n        [Sale Key], [City Key], [Customer Key], [Bill To Customer Key], [Stock Item Key], [Invoice Date Key], [Delivery Date Key], [Salesperson Key], [WWI Invoice ID], [Description], [Package], [Quantity], [Unit Price], [Tax Rate], [Total Excluding Tax], [Tax Amount], [Profit], [Total Including Tax], [Total Dry Items], [Total Chiller Items], [Lineage Key]\n    FROM [wwi].[seed_Sale]\nEND;\n\n\n  --12.Create this stored procedure that populates rows into wwi.dimension_Date.\nCREATE PROCEDURE [wwi].[PopulateDateDimensionForYear] @Year [int] AS\nBEGIN\n    IF OBJECT_ID('tempdb..#month', 'U') IS NOT NULL\n        DROP TABLE #month\n    CREATE TABLE #month (\n        monthnum int,\n        numofdays int\n    )\n    WITH ( DISTRIBUTION = ROUND_ROBIN, heap )\n    INSERT INTO #month\n        SELECT 1, 31 UNION SELECT 2, CASE WHEN (@YEAR % 4 = 0 AND @YEAR % 100 <> 0) OR @YEAR % 400 = 0 THEN 29 ELSE 28 END UNION SELECT 3,31 UNION SELECT 4,30 UNION SELECT 5,31 UNION SELECT 6,30 UNION SELECT 7,31 UNION SELECT 8,31 UNION SELECT 9,30 UNION SELECT 10,31 UNION SELECT 11,30 UNION SELECT 12,31\n\n    IF OBJECT_ID('tempdb..#days', 'U') IS NOT NULL\n        DROP TABLE #days\n    CREATE TABLE #days (days int)\n    WITH (DISTRIBUTION = ROUND_ROBIN, HEAP)\n\n    INSERT INTO #days\n        SELECT 1 UNION SELECT 2 UNION SELECT 3 UNION SELECT 4 UNION SELECT 5 UNION SELECT 6 UNION SELECT 7 UNION SELECT 8 UNION SELECT 9 UNION SELECT 10 UNION SELECT 11 UNION SELECT 12 UNION SELECT 13 UNION SELECT 14 UNION SELECT 15 UNION SELECT 16 UNION SELECT 17 UNION SELECT 18 UNION SELECT 19 UNION SELECT 20    UNION SELECT 21 UNION SELECT 22 UNION SELECT 23 UNION SELECT 24 UNION SELECT 25 UNION SELECT 26 UNION SELECT 27 UNION SELECT 28 UNION SELECT 29 UNION SELECT 30 UNION SELECT 31\n\n    INSERT [wwi].[dimension_Date] (\n        [Date], [Day Number], [Day], [Month], [Short Month], [Calendar Month Number], [Calendar Month Label], [Calendar Year], [Calendar Year Label], [Fiscal Month Number], [Fiscal Month Label], [Fiscal Year], [Fiscal Year Label], [ISO Week Number]\n    )\n    SELECT\n        CAST(CAST(monthnum AS VARCHAR(2)) + '/' + CAST([days] AS VARCHAR(3)) + '/' + CAST(@year AS CHAR(4)) AS DATE) AS [Date]\n        ,DAY(CAST(CAST(monthnum AS VARCHAR(2)) + '/' + CAST([days] AS VARCHAR(3)) + '/' + CAST(@year AS CHAR(4)) AS DATE)) AS [Day Number]\n        ,CAST(DATENAME(day, CAST(CAST(monthnum AS VARCHAR(2)) + '/' + CAST([days] AS VARCHAR(3)) + '/' + CAST(@year AS CHAR(4)) AS DATE)) AS NVARCHAR(10)) AS [Day]\n        ,CAST(DATENAME(month, CAST(CAST(monthnum AS VARCHAR(2)) + '/' + CAST([days] AS VARCHAR(3)) + '/' + CAST(@year as char(4)) AS DATE)) AS nvarchar(10)) AS [Month]\n        ,CAST(SUBSTRING(DATENAME(month, CAST(CAST(monthnum as varchar(2)) + '/' + CAST([days] as varchar(3)) + '/' + CAST(@year as char(4)) AS DATE)), 1, 3) AS nvarchar(3)) AS [Short Month]\n        ,MONTH(CAST(CAST(monthnum as varchar(2)) + '/' + CAST([days] as varchar(3)) + '/' + CAST(@year as char(4)) AS DATE)) AS [Calendar Month Number]\n        ,CAST(N'CY' + CAST(YEAR(CAST(CAST(monthnum as varchar(2)) + '/' + CAST([days] as varchar(3)) + '/' + CAST(@year as char(4)) AS DATE)) AS nvarchar(4)) + N'-' + SUBSTRING(DATENAME(month, CAST(CAST(monthnum as varchar(2)) + '/' + CAST([days] as varchar(3)) + '/' + CAST(@year as char(4)) AS DATE)), 1, 3) AS nvarchar(10)) AS [Calendar Month Label]\n        ,YEAR(CAST(CAST(monthnum as varchar(2)) + '/' + CAST([days] as varchar(3)) + '/' + CAST(@year as char(4)) AS DATE)) AS [Calendar Year]\n        ,CAST(N'CY' + CAST(YEAR(CAST(CAST(monthnum as varchar(2)) + '/' + CAST([days] as varchar(3)) + '/' + CAST(@year as char(4)) AS DATE)) AS nvarchar(4)) AS nvarchar(10)) AS [Calendar Year Label]\n        ,CASE WHEN MONTH(CAST(CAST(monthnum as varchar(2)) + '/' + CAST([days] as varchar(3)) + '/' + CAST(@year as char(4)) AS DATE)) IN (11, 12)\n        THEN MONTH(CAST(CAST(monthnum as varchar(2)) + '/' + CAST([days] as varchar(3)) + '/' + CAST(@year as char(4)) AS DATE)) - 10\n        ELSE MONTH(CAST(CAST(monthnum as varchar(2)) + '/' + CAST([days] as varchar(3)) + '/' + CAST(@year as char(4)) AS DATE)) + 2 END AS [Fiscal Month Number]\n        ,CAST(N'FY' + CAST(CASE WHEN MONTH(CAST(CAST(monthnum as varchar(2)) + '/' + CAST([days] as varchar(3)) + '/' + CAST(@year as char(4)) AS DATE)) IN (11, 12)\n        THEN YEAR(CAST(CAST(monthnum as varchar(2)) + '/' + CAST([days] as varchar(3)) + '/' + CAST(@year as char(4)) AS DATE)) + 1\n        ELSE YEAR(CAST(CAST(monthnum as varchar(2)) + '/' + CAST([days] as varchar(3)) + '/' + CAST(@year as char(4)) AS DATE)) END AS nvarchar(4)) + N'-' + SUBSTRING(DATENAME(month, CAST(CAST(monthnum as varchar(2)) + '/' + CAST([days] as varchar(3)) + '/' + CAST(@year as char(4)) AS DATE)), 1, 3) AS nvarchar(20)) AS [Fiscal Month Label]\n        ,CASE WHEN MONTH(CAST(CAST(monthnum as varchar(2)) + '/' + CAST([days] as varchar(3)) + '/' + CAST(@year as char(4)) AS DATE)) IN (11, 12)\n        THEN YEAR(CAST(CAST(monthnum as varchar(2)) + '/' + CAST([days] as varchar(3)) + '/' + CAST(@year as char(4)) AS DATE)) + 1\n        ELSE YEAR(CAST(CAST(monthnum as varchar(2)) + '/' + CAST([days] as varchar(3)) + '/' + CAST(@year as char(4)) AS DATE)) END AS [Fiscal Year]\n        ,CAST(N'FY' + CAST(CASE WHEN MONTH(CAST(CAST(monthnum as varchar(2)) + '/' + CAST([days] as varchar(3)) + '/' + CAST(@year as char(4)) AS DATE)) IN (11, 12)\n        THEN YEAR(CAST(CAST(monthnum as varchar(2)) + '/' + CAST([days] as varchar(3)) + '/' + CAST(@year as char(4)) AS DATE)) + 1\n        ELSE YEAR(CAST(CAST(monthnum as varchar(2)) + '/' + CAST([days] as varchar(3)) + '/' + CAST(@year as char(4)) AS DATE))END AS nvarchar(4)) AS nvarchar(10)) AS [Fiscal Year Label]\n        , DATEPART(ISO_WEEK, CAST(CAST(monthnum as varchar(2)) + '/' + CAST([days] as varchar(3)) + '/' + CAST(@year as char(4)) AS DATE)) AS [ISO Week Number]\nFROM #month m\n    CROSS JOIN #days d\nWHERE d.days <= m.numofdays\n\nDROP table #month;\nDROP table #days;\nEND;\n\n\n  --13.Create this procedure that populates the wwi.dimension_Date and wwi.fact_Sale tables. It calls [wwi].[PopulateDateDimensionForYear] to populate wwi.dimension_Date.\n    --DROP PROCEDURE [wwi].[Configuration_PopulateLargeSaleTable];\nCREATE PROCEDURE [wwi].[Configuration_PopulateLargeSaleTable] @EstimatedRowsPerDay [bigint],@Year [int] AS\nBEGIN\n    SET NOCOUNT ON;\n    SET XACT_ABORT ON;\n\n    EXEC [wwi].[PopulateDateDimensionForYear] @Year;\n\n    DECLARE @OrderCounter bigint = 0;\n    DECLARE @NumberOfSalesPerDay bigint = @EstimatedRowsPerDay;\n    DECLARE @DateCounter date;\n    DECLARE @StartingSaleKey bigint;\n    DECLARE @MaximumSaleKey bigint = (SELECT MAX([Sale Key]) FROM wwi.seed_Sale_Small);\n    DECLARE @MaxDate date;\n    SET @MaxDate = (SELECT MAX([Invoice Date Key]) FROM wwi.fact_Sale)\n    IF ( @MaxDate < CAST(@YEAR AS CHAR(4)) + '1231') AND (@MaxDate > CAST(@YEAR AS CHAR(4)) + '0101')\n        SET @DateCounter = @MaxDate\n    ELSE\n        SET @DateCounter= CAST(@Year as char(4)) + '0101';\n\n    PRINT 'Targeting ' + CAST(@NumberOfSalesPerDay AS varchar(20)) + ' sales per day.';\n\n    DECLARE @OutputCounter varchar(20);\n    DECLARE @variance DECIMAL(18,10);\n    DECLARE @VariantNumberOfSalesPerDay BIGINT;\n\n    WHILE @DateCounter < CAST(@YEAR AS CHAR(4)) + '1231'\n    BEGIN\n        SET @OutputCounter = CONVERT(varchar(20), @DateCounter, 112);\n        RAISERROR(@OutputCounter, 0, 1);\n        SET @variance = (SELECT RAND() * 10)*.01 + .95\n        SET @VariantNumberOfSalesPerDay = FLOOR(@NumberOfSalesPerDay * @variance)\n\n        SET @StartingSaleKey = @MaximumSaleKey - @VariantNumberOfSalesPerDay - FLOOR(RAND() * 20000);\n        SET @OrderCounter = 0;\n\n        INSERT [wwi].[fact_Sale] (\n            [City Key], [Customer Key], [Bill To Customer Key], [Stock Item Key], [Invoice Date Key], [Delivery Date Key], [Salesperson Key], [WWI Invoice ID], [Description], Package, Quantity, [Unit Price], [Tax Rate], [Total Excluding Tax], [Tax Amount], Profit, [Total Including Tax], [Total Dry Items], [Total Chiller Items], [Lineage Key]\n        )\n        SELECT TOP(@VariantNumberOfSalesPerDay)\n            [City Key], [Customer Key], [Bill To Customer Key], [Stock Item Key], @DateCounter, DATEADD(day, 1, @DateCounter), [Salesperson Key], [WWI Invoice ID], [Description], Package, Quantity, [Unit Price], [Tax Rate], [Total Excluding Tax], [Tax Amount], Profit, [Total Including Tax], [Total Dry Items], [Total Chiller Items], [Lineage Key]\n        FROM [wwi].[seed_Sale_Small]\n        WHERE\n             --[Sale Key] > @StartingSaleKey and /* IDENTITY DOES NOT WORK THE SAME IN SQLDW AND CAN'T USE THIS METHOD FOR VARIANT */\n            [Invoice Date Key] >=cast(@YEAR AS CHAR(4)) + '-01-01'\n        ORDER BY [Sale Key];\n\n        SET @DateCounter = DATEADD(day, 1, @DateCounter);\n    END;\n\nEND;\n\n\n  --14.Generate millions of rows\n\n--EXEC [wwi].[InitialSalesDataPopulation];\n\n  --14.2 Run this procedure to populate wwi.fact_Sale with 100 rows per day for each day between the year 2000 and 2003.\nEXEC [wwi].[Configuration_PopulateLargeSaleTable] 1000, 2000;\nEXEC [wwi].[Configuration_PopulateLargeSaleTable] 1000, 2001;\nEXEC [wwi].[Configuration_PopulateLargeSaleTable] 1000, 2002;\nEXEC [wwi].[Configuration_PopulateLargeSaleTable] 1000, 2003;\n\n\n\n  --15. Create statistics on newly loaded data \n  --15.1 Create this stored procedure that updates statistics on all columns of all tables.\n    --DROP PROCEDURE    [dbo].[prc_sqldw_create_stats];\nCREATE PROCEDURE    [dbo].[prc_sqldw_create_stats]\n(   @create_type    tinyint -- 1 default 2 Fullscan 3 Sample\n,   @sample_pct     tinyint\n)\nAS\n\nIF @create_type IS NULL\nBEGIN\n    SET @create_type = 1;\nEND;\n\nIF @create_type NOT IN (1,2,3)\nBEGIN\n    THROW 151000,'Invalid value for @stats_type parameter. Valid range 1 (default), 2 (fullscan) or 3 (sample).',1;\nEND;\n\nIF @sample_pct IS NULL\nBEGIN;\n    SET @sample_pct = 20;\nEND;\n\nIF OBJECT_ID('tempdb..#stats_ddl') IS NOT NULL\nBEGIN;\n    DROP TABLE #stats_ddl;\nEND;\n\nCREATE TABLE #stats_ddl\nWITH    (   DISTRIBUTION    = HASH([seq_nmbr])\n        ,   LOCATION        = USER_DB\n        )\nAS\nWITH T\nAS\n(\nSELECT      t.[name]                        AS [table_name]\n,           s.[name]                        AS [table_schema_name]\n,           c.[name]                        AS [column_name]\n,           c.[column_id]                   AS [column_id]\n,           t.[object_id]                   AS [object_id]\n,           ROW_NUMBER()\n            OVER(ORDER BY (SELECT NULL))    AS [seq_nmbr]\nFROM        sys.[tables] t\nJOIN        sys.[schemas] s         ON  t.[schema_id]       = s.[schema_id]\nJOIN        sys.[columns] c         ON  t.[object_id]       = c.[object_id]\nLEFT JOIN   sys.[stats_columns] l   ON  l.[object_id]       = c.[object_id]\n                                    AND l.[column_id]       = c.[column_id]\n                                    AND l.[stats_column_id] = 1\nLEFT JOIN    sys.[external_tables] e    ON    e.[object_id]        = t.[object_id]\nWHERE       l.[object_id] IS NULL\nAND            e.[object_id] IS NULL -- not an external table\n)\nSELECT  [table_schema_name]\n,       [table_name]\n,       [column_name]\n,       [column_id]\n,       [object_id]\n,       [seq_nmbr]\n,       CASE @create_type\n        WHEN 1\n        THEN    CAST('CREATE STATISTICS '+QUOTENAME('stat_'+table_schema_name+ '_' + table_name + '_'+column_name)+' ON '+QUOTENAME(table_schema_name)+'.'+QUOTENAME(table_name)+'('+QUOTENAME(column_name)+')' AS VARCHAR(8000))\n        WHEN 2\n        THEN    CAST('CREATE STATISTICS '+QUOTENAME('stat_'+table_schema_name+ '_' + table_name + '_'+column_name)+' ON '+QUOTENAME(table_schema_name)+'.'+QUOTENAME(table_name)+'('+QUOTENAME(column_name)+') WITH FULLSCAN' AS VARCHAR(8000))\n        WHEN 3\n        THEN    CAST('CREATE STATISTICS '+QUOTENAME('stat_'+table_schema_name+ '_' + table_name + '_'+column_name)+' ON '+QUOTENAME(table_schema_name)+'.'+QUOTENAME(table_name)+'('+QUOTENAME(column_name)+') WITH SAMPLE '+CONVERT(varchar(4),@sample_pct)+' PERCENT' AS VARCHAR(8000))\n        END AS create_stat_ddl\nFROM T\n;\n\nDECLARE @i INT              = 1\n,       @t INT              = (SELECT COUNT(*) FROM #stats_ddl)\n,       @s NVARCHAR(4000)   = N''\n;\n\nWHILE @i <= @t\nBEGIN\n    SET @s=(SELECT create_stat_ddl FROM #stats_ddl WHERE seq_nmbr = @i);\n    PRINT @s\n    EXEC sp_executesql @s\n    SET @i+=1;\nEND\n\nDROP TABLE #stats_ddl;\n\n  --15.2 Run this command to create statistics on all columns of all tables in the data warehouse.\nEXEC [dbo].[prc_sqldw_create_stats] 1, NULL;\n\n",
					"metadata": {
						"language": "sql"
					},
					"currentConnection": {
						"poolName": "dwtest01",
						"databaseName": "master"
					},
					"resultLimit": 5000
				},
				"type": "SqlQuery"
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('workspaceName'), '/SQL script 1')]",
			"type": "Microsoft.Synapse/workspaces/sqlscripts",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"content": {
					"query": "DROP TABLE [dbo].[DimCustomer]\nGO\n\nCREATE TABLE [dbo].[DimCustomer](\n\t[CustomerKey] [int] NOT NULL,\n\t[CustomerAlternateKey] [nvarchar](15) NOT NULL,\n\t[FirstName] [nvarchar](50) NULL,\n\t[MiddleName] [nvarchar](50) NULL,\n\t[LastName] [nvarchar](50) NULL,\n\t[NameStyle] [bit] NULL,\n\t[BirthDate] [date] NULL,\n\t[MaritalStatus] [nchar](1) NULL,\n\t[Gender] [nvarchar](1) NULL,\n\t[EmailAddress] [nvarchar](50) NULL,\n\t[YearlyIncome] [money] NULL,\n\t[TotalChildren] [tinyint] NULL,\n\t[NumberChildrenAtHome] [tinyint] NULL,\n\t[EnglishEducation] [nvarchar](40) NULL,\n\t[EnglishOccupation] [nvarchar](100) NULL,\n\t[HouseOwnerFlag] [nchar](1) NULL,\n\t[NumberCarsOwned] [tinyint] NULL,\n\t[AddressLine1] [nvarchar](120) NULL,\n\t[Phone] [nvarchar](20) NULL,\n\t[DateFirstPurchase] [date] NULL,\n\t[CommuteDistance] [nvarchar](15) NULL\n) \nGO\n\n\n\nCREATE TABLE [dbo].[DimProduct](\n\t[ProductKey] [int] NOT NULL,\n\t[ProductAlternateKey] [nvarchar](25) NULL,\n\t[ProductName] [nvarchar](50) NOT NULL,\n\tSubcategory [nvarchar](50) NOT NULL,\n\tCategory [nvarchar](50) NOT NULL,\n\t[StandardCost] [money] NULL,\n\t[Color] [nvarchar](15) NOT NULL,\n\t[ListPrice] [money] NULL,\n\t[DaysToManufacture] [int] NULL,\n\t[ProductLine] [nchar](2) NULL,\n\t[DealerPrice] [money] NULL,\n\t[Class] [nchar](2) NULL,\n\t[Style] [nchar](2) NULL,\n\t[ModelName] [nvarchar](50) NULL\n) \nGO\n\n\nCREATE TABLE [dbo].[DimSalesTerritory](\n\t[SalesTerritoryKey] [int] NOT NULL,\n\t[SalesTerritoryAlternateKey] [int] NULL,\n\t[SalesTerritoryRegion] [nvarchar](50) NOT NULL,\n\t[SalesTerritoryCountry] [nvarchar](50) NOT NULL,\n\t[SalesTerritoryGroup] [nvarchar](50) NULL\n) \nGO\n\n\n\nCREATE TABLE [dbo].[FactInternetSales](\n\t[ProductKey] [int] NOT NULL,\n\t[OrderDateKey] [int] NOT NULL,\n\t[DueDateKey] [int] NOT NULL,\n\t[ShipDateKey] [int] NOT NULL,\n\t[CustomerKey] [int] NOT NULL,\n\t[PromotionKey] [int] NOT NULL,\n\t[CurrencyKey] [int] NOT NULL,\n\t[SalesTerritoryKey] [int] NOT NULL,\n\t[SalesOrderNumber] [nvarchar](20) NOT NULL,\n\t[SalesOrderLineNumber] [tinyint] NOT NULL,\n\t[RevisionNumber] [tinyint] NOT NULL,\n\t[OrderQuantity] [smallint] NOT NULL,\n\t[UnitPrice] [money] NOT NULL,\n\t[ExtendedAmount] [money] NOT NULL,\n\t[UnitPriceDiscountPct] [float] NOT NULL,\n\t[DiscountAmount] [float] NOT NULL,\n\t[ProductStandardCost] [money] NOT NULL,\n\t[TotalProductCost] [money] NOT NULL,\n\t[SalesAmount] [money] NOT NULL,\n\t[TaxAmt] [money] NOT NULL,\n\t[Freight] [money] NOT NULL,\n\t[CarrierTrackingNumber] [nvarchar](25) NULL,\n\t[CustomerPONumber] [nvarchar](25) NULL,\n\t[OrderDate] [datetime] NULL,\n\t[DueDate] [datetime] NULL,\n\t[ShipDate] [datetime] NULL\n) \nGO\n\nCREATE TABLE [dbo].[DimEmployee](\n\t[EmployeeKey] [int] NOT NULL,\n\t[ParentEmployeeKey] [int] NULL,\n\t[EmployeeNationalIDAlternateKey] [nvarchar](15) NULL,\n\t[ParentEmployeeNationalIDAlternateKey] [nvarchar](15) NULL,\n\t[SalesTerritoryKey] [int] NULL,\n\t[FirstName] [nvarchar](50) NOT NULL,\n\t[LastName] [nvarchar](50) NOT NULL,\n\t[MiddleName] [nvarchar](50) NULL,\n\t[NameStyle] [bit] NOT NULL,\n\t[Title] [nvarchar](50) NULL,\n\t[HireDate] [date] NULL,\n\t[BirthDate] [date] NULL,\n\t[LoginID] [nvarchar](256) NULL,\n\t[EmailAddress] [nvarchar](50) NULL,\n\t[Phone] [nvarchar](25) NULL,\n\t[MaritalStatus] [nchar](1) NULL,\n\t[EmergencyContactName] [nvarchar](50) NULL,\n\t[EmergencyContactPhone] [nvarchar](25) NULL,\n\t[SalariedFlag] [bit] NULL,\n\t[Gender] [nchar](1) NULL,\n\t[PayFrequency] [tinyint] NULL,\n\t[BaseRate] [money] NULL,\n\t[VacationHours] [smallint] NULL,\n\t[SickLeaveHours] [smallint] NULL,\n\t[CurrentFlag] [bit] NOT NULL,\n\t[SalesPersonFlag] [bit] NOT NULL,\n\t[DepartmentName] [nvarchar](50) NULL,\n\t[StartDate] [date] NULL,\n\t[EndDate] [date] NULL,\n\t[Status] [nvarchar](50) NULL ) \nGO\n\n\n\nCREATE TABLE [dbo].[DimDate](\n\t[DateKey] [int] NOT NULL,\n\t[FullDateAlternateKey] [date] NOT NULL,\n\t[DayNumberOfWeek] [tinyint] NOT NULL,\n\t[DayNameOfWeek] [nvarchar](10) NOT NULL,\n\t[DayNumberOfMonth] [tinyint] NOT NULL,\n\t[DayNumberOfYear] [smallint] NOT NULL,\n\t[WeekNumberOfYear] [tinyint] NOT NULL,\n\t[MonthName] [nvarchar](10) NOT NULL,\n\t[MonthNumberOfYear] [tinyint] NOT NULL,\n\t[CalendarQuarter] [tinyint] NOT NULL,\n\t[CalendarYear] [smallint] NOT NULL,\n\t[CalendarSemester] [tinyint] NOT NULL,\n\t[FiscalQuarter] [tinyint] NOT NULL,\n\t[FiscalYear] [smallint] NOT NULL,\n\t[FiscalSemester] [tinyint] NOT NULL\n) \nGO\n\n\nCREATE TABLE [dbo].[DimGeography](\n\t[GeographyKey] [int] NOT NULL,\n\t[City] [nvarchar](30) NULL,\n\t[StateProvinceCode] [nvarchar](3) NULL,\n\t[StateProvinceName] [nvarchar](50) NULL,\n\t[CountryRegionCode] [nvarchar](3) NULL,\n\t[CountryRegionName] [nvarchar](50) NULL,\n\t[PostalCode] [nvarchar](15) NULL,\n\t[SalesTerritoryKey] [int] NULL,\n\t[IpAddressLocator] [nvarchar](15) NULL\n) \nGO\n\n\nCREATE TABLE [dbo].[DimReseller](\n\t[ResellerKey] [int] NOT NULL,\n\t[GeographyKey] [int] NULL,\n\t[ResellerAlternateKey] [nvarchar](15) NULL,\n\t[Phone] [nvarchar](25) NULL,\n\t[BusinessType] [varchar](20) NOT NULL,\n\t[ResellerName] [nvarchar](50) NOT NULL,\n\t[NumberEmployees] [int] NULL,\n\t[OrderFrequency] [char](1) NULL,\n\t[OrderMonth] [tinyint] NULL,\n\t[FirstOrderYear] [int] NULL,\n\t[LastOrderYear] [int] NULL,\n\t[ProductLine] [nvarchar](50) NULL,\n\t[AddressLine1] [nvarchar](60) NULL,\n\t[AddressLine2] [nvarchar](60) NULL,\n\t[AnnualSales] [money] NULL,\n\t[BankName] [nvarchar](50) NULL,\n\t[MinPaymentType] [tinyint] NULL,\n\t[MinPaymentAmount] [money] NULL,\n\t[AnnualRevenue] [money] NULL,\n\t[YearOpened] [int] NULL\n) \nGO\n\n\nCREATE TABLE [dbo].[DimCurrency](\n\t[CurrencyKey] [int] NOT NULL,\n\t[CurrencyAlternateKey] [nchar](3) NOT NULL,\n\t[CurrencyName] [nvarchar](50) NOT NULL\n) \nGO\n\nCREATE TABLE [dbo].[DimPromotion](\n\t[PromotionKey] [int] NOT NULL,\n\t[PromotionAlternateKey] [int] NULL,\n\t[PromotionName] [nvarchar](255) NULL,\n\t[DiscountPct] [float] NULL,\n\t[PromotionType] [nvarchar](50) NULL,\n\t[PromotionCategory] [nvarchar](50) NULL,\n\t[StartDate] [datetime] NOT NULL,\n\t[EndDate] [datetime] NULL,\n\t[MinQty] [int] NULL,\n\t[MaxQty] [int] NULL\n) \nGO\n\n\nCREATE TABLE [dbo].[FactResellerSales](\n\t[ProductKey] [int] NOT NULL,\n\t[OrderDateKey] [int] NOT NULL,\n\t[DueDateKey] [int] NOT NULL,\n\t[ShipDateKey] [int] NOT NULL,\n\t[ResellerKey] [int] NOT NULL,\n\t[EmployeeKey] [int] NOT NULL,\n\t[PromotionKey] [int] NOT NULL,\n\t[CurrencyKey] [int] NOT NULL,\n\t[SalesTerritoryKey] [int] NOT NULL,\n\t[SalesOrderNumber] [nvarchar](20) NOT NULL,\n\t[SalesOrderLineNumber] [tinyint] NOT NULL,\n\t[RevisionNumber] [tinyint] NULL,\n\t[OrderQuantity] [smallint] NULL,\n\t[UnitPrice] [money] NULL,\n\t[ExtendedAmount] [money] NULL,\n\t[UnitPriceDiscountPct] [float] NULL,\n\t[DiscountAmount] [float] NULL,\n\t[ProductStandardCost] [money] NULL,\n\t[TotalProductCost] [money] NULL,\n\t[SalesAmount] [money] NULL,\n\t[TaxAmt] [money] NULL,\n\t[Freight] [money] NULL,\n\t[CarrierTrackingNumber] [nvarchar](25) NULL,\n\t[CustomerPONumber] [nvarchar](25) NULL,\n\t[OrderDate] [datetime] NULL,\n\t[DueDate] [datetime] NULL,\n\t[ShipDate] [datetime] NULL\n) \nGO\n\n\nCREATE TABLE [dbo].[DimDateGPNW](\n\t[SID_Date] [int] NOT NULL,\n\t[CalendarDate] [date] NOT NULL,\n\t[IsVisible] [bit] NOT NULL,\n\t[CalendarYearNo] [int] NOT NULL,\n\t[CalendarYearName] [nvarchar](50) NOT NULL,\n\t[CalendarHalfNo] [int] NOT NULL,\n\t[CalendarHalfName] [nvarchar](50) NOT NULL,\n\t[CalendarQtrNo] [int] NOT NULL,\n\t[CalendarQtrName] [nvarchar](50) NOT NULL,\n\t[CalendarMonthNo] [int] NOT NULL,\n\t[CalendarMonthDayNo] [int] NOT NULL,\n\t[CalendarMonthName] [nvarchar](50) NOT NULL,\n\t[CalendarMonthStart] [date] NOT NULL,\n\t[CalendarMonthEnd] [date] NOT NULL,\n\t[CalendarYearHalfNo] [int] NOT NULL,\n\t[CalendarYearHalfName] [nvarchar](50) NOT NULL,\n\t[CalendarYearQtrNo] [int] NOT NULL,\n\t[CalendarYearQtrName] [nvarchar](50) NOT NULL,\n\t[CalendarYearMonthNo] [int] NOT NULL,\n\t[CalendarYearMonthName] [nvarchar](50) NOT NULL,\n\t[ScheduleWeekKey] [int] NOT NULL,\n\t[ScheduleYearNo] [int] NOT NULL,\n\t[ScheduleYearName] [nvarchar](50) NOT NULL,\n\t[ScheduleWeekNo] [int] NOT NULL,\n\t[ScheduleWeekName] [nvarchar](50) NOT NULL,\n\t[ScheduleYearWeekNo] [int] NOT NULL,\n\t[ScheduleYearWeekName] [nvarchar](50) NOT NULL,\n\t[ScheduleWeekDayNo] [int] NOT NULL,\n\t[ScheduleWeekDayName] [nvarchar](50) NOT NULL,\n\t[ScheduleWeekDayType] [nvarchar](50) NOT NULL\n) \nGO\n",
					"metadata": {
						"language": "sql"
					},
					"currentConnection": {
						"poolName": "dwtest01",
						"databaseName": "dwtest01"
					},
					"resultLimit": 5000
				},
				"type": "SqlQuery"
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('workspaceName'), '/SQL script 2')]",
			"type": "Microsoft.Synapse/workspaces/sqlscripts",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"content": {
					"query": "SELECT TOP (100) [CustomerKey]\n,[CustomerAlternateKey]\n,[FirstName]\n,[MiddleName]\n,[LastName]\n,[NameStyle]\n,[BirthDate]\n,[MaritalStatus]\n,[Gender]\n,[EmailAddress]\n,[YearlyIncome]\n,[TotalChildren]\n,[NumberChildrenAtHome]\n,[EnglishEducation]\n,[EnglishOccupation]\n,[HouseOwnerFlag]\n,[NumberCarsOwned]\n,[AddressLine1]\n,[Phone]\n,[DateFirstPurchase]\n,[CommuteDistance]\n FROM [dbo].[DimCustomer] \n\n SELECT COUNT(*)  FROM [dbo].[DimCustomer]\n  --18484\n",
					"metadata": {
						"language": "sql"
					},
					"currentConnection": {
						"poolName": "dwtest01",
						"databaseName": "dwtest01"
					},
					"resultLimit": 5000
				},
				"type": "SqlQuery"
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('workspaceName'), '/SQL script 3')]",
			"type": "Microsoft.Synapse/workspaces/sqlscripts",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"content": {
					"query": "CREATE PROC [dbo].[truncatetables]\n\nAS\n\nBEGIN\n\nTRUNCATE TABLE DBO.DimCustomer; \n\nTRUNCATE TABLE DBO.DimProduct; \n\nTRUNCATE TABLE DBO.DimSalesTerritory; \n\nTRUNCATE TABLE DBO.DimEmployee; \n\nTRUNCATE TABLE DBO.DimDate; \n\nTRUNCATE TABLE DBO.DimDateGPNW; \n\nTRUNCATE TABLE DBO.DimGeography; \n\nTRUNCATE TABLE DBO.DimReseller; \n\nTRUNCATE TABLE DBO.DimCurrency;\n\nTRUNCATE TABLE DBO.DimPromotion;\n\nTRUNCATE TABLE DBO.FactInternetSales; \n\nTRUNCATE TABLE DBO.FactResellerSales; \n\nEND\n",
					"metadata": {
						"language": "sql"
					},
					"currentConnection": {
						"poolName": "dwtest01",
						"databaseName": "dwtest01"
					},
					"resultLimit": 5000
				},
				"type": "SqlQuery"
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('workspaceName'), '/SQL script 4')]",
			"type": "Microsoft.Synapse/workspaces/sqlscripts",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"content": {
					"query": "CREATE TABLE [dbo].[CustomerSource] (\n    [CustomerID] [int] NOT NULL,\n    [Title] [nvarchar](8),\n    [FirstName] [nvarchar](50),\n    [MiddleName] [nvarchar](50),\n    [LastName] [nvarchar](50),\n    [Suffix] [nvarchar](10),\n    [CompanyName] [nvarchar](128),\n    [SalesPerson] [nvarchar](256),\n    [EmailAddress] [nvarchar](50),\n    [Phone] [nvarchar](25)\n) WITH ( HEAP )\n\nCOPY INTO [dbo].[CustomerSource]\nFROM 'https://solliancepublicdata.blob.core.windows.net/dataengineering/dp-203/awdata/CustomerSource.csv'\nWITH (\n    FILE_TYPE='CSV',\n    FIELDTERMINATOR='|',\n    FIELDQUOTE='',\n    ROWTERMINATOR='0x0a',\n    ENCODING = 'UTF16'\n)\n\nCREATE TABLE dbo.[DimCustomer_SCD](\n    [CustomerID] [int] NOT NULL,\n    [Title] [nvarchar](8) NULL,\n    [FirstName] [nvarchar](50) NOT NULL,\n    [MiddleName] [nvarchar](50) NULL,\n    [LastName] [nvarchar](50) NOT NULL,\n    [Suffix] [nvarchar](10) NULL,\n    [CompanyName] [nvarchar](128) NULL,\n    [SalesPerson] [nvarchar](256) NULL,\n    [EmailAddress] [nvarchar](50) NULL,\n    [Phone] [nvarchar](25) NULL,\n    [InsertedDate] [datetime] NOT NULL,\n    [ModifiedDate] [datetime] NOT NULL,\n    [HashKey] [char](66)\n)\nWITH\n(\n    DISTRIBUTION = REPLICATE,\n    CLUSTERED COLUMNSTORE INDEX\n)",
					"metadata": {
						"language": "sql"
					},
					"currentConnection": {
						"poolName": "dwtest01",
						"databaseName": "dwtest01"
					},
					"resultLimit": 5000
				},
				"type": "SqlQuery"
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('workspaceName'), '/SQL script 5')]",
			"type": "Microsoft.Synapse/workspaces/sqlscripts",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"content": {
					"query": "SELECT TOP (100) [PassengerCount]\n,[SumTripDistance]\n,[AvgTripDistance]\n FROM [nyctaxi].[dbo].[passengercountstats]",
					"metadata": {
						"language": "sql"
					},
					"currentConnection": {
						"poolName": "Built-in",
						"databaseName": "nyctaxi"
					},
					"resultLimit": 5000
				},
				"type": "SqlQuery"
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('workspaceName'), '/SQL script 6')]",
			"type": "Microsoft.Synapse/workspaces/sqlscripts",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"content": {
					"query": "CREATE TABLE [dbo].[FactResellerSales_Synapse](\n    [ProductKey] [int] NOT NULL,\n    [OrderDateKey] [int] NOT NULL,\n    [DueDateKey] [int] NOT NULL,\n    [ShipDateKey] [int] NOT NULL,\n    [ResellerKey] [int] NOT NULL,\n    [EmployeeKey] [int] NOT NULL,\n    [PromotionKey] [int] NOT NULL,\n    [CurrencyKey] [int] NOT NULL,\n    [SalesTerritoryKey] [int] NOT NULL,\n    [SalesOrderNumber] [nvarchar](20) NOT NULL,\n    [SalesOrderLineNumber] [tinyint] NOT NULL,\n    [RevisionNumber] [tinyint] NULL,\n    [OrderQuantity] [smallint] NULL,\n    [UnitPrice] [money] NULL,\n    [ExtendedAmount] [money] NULL,\n    [UnitPriceDiscountPct] [float] NULL,\n    [DiscountAmount] [float] NULL,\n    [ProductStandardCost] [money] NULL,\n    [TotalProductCost] [money] NULL,\n    [SalesAmount] [money] NULL,\n    [TaxAmt] [money] NULL,\n    [Freight] [money] NULL,\n    [CarrierTrackingNumber] [nvarchar](25) NULL,\n    [CustomerPONumber] [nvarchar](25) NULL,\n    [OrderDate] [datetime] NULL,\n    [DueDate] [datetime] NULL,\n    [ShipDate] [datetime] NULL\n)\nWITH\n(\n    DISTRIBUTION = HASH([SalesOrderNumber]),\n    CLUSTERED COLUMNSTORE INDEX\n);\nGO\n\nCREATE TABLE [dbo].[DimReseller_Synapse](\n    [ResellerKey] [int] NOT NULL,\n    [GeographyKey] [int] NULL,\n    [ResellerAlternateKey] [nvarchar](15) NULL,\n    [Phone] [nvarchar](25) NULL,\n    [BusinessType] [varchar](20) NOT NULL,\n    [ResellerName] [nvarchar](50) NOT NULL,\n    [NumberEmployees] [int] NULL,\n    [OrderFrequency] [char](1) NULL,\n    [OrderMonth] [tinyint] NULL,\n    [FirstOrderYear] [int] NULL,\n    [LastOrderYear] [int] NULL,\n    [ProductLine] [nvarchar](50) NULL,\n    [AddressLine1] [nvarchar](60) NULL,\n    [AddressLine2] [nvarchar](60) NULL,\n    [AnnualSales] [money] NULL,\n    [BankName] [nvarchar](50) NULL,\n    [MinPaymentType] [tinyint] NULL,\n    [MinPaymentAmount] [money] NULL,\n    [AnnualRevenue] [money] NULL,\n    [YearOpened] [int] NULL\n)\nWITH\n(\n    DISTRIBUTION = REPLICATE,\n    CLUSTERED COLUMNSTORE INDEX\n);\nGO\n\nCREATE TABLE [dbo].[DimEmployee_Synapse](\n    [EmployeeKey] [int] NOT NULL,\n    [ParentEmployeeKey] [int] NULL,\n    [EmployeeNationalIDAlternateKey] [nvarchar](15) NULL,\n    [ParentEmployeeNationalIDAlternateKey] [nvarchar](15) NULL,\n    [SalesTerritoryKey] [int] NULL,\n    [FirstName] [nvarchar](50) NOT NULL,\n    [LastName] [nvarchar](50) NOT NULL,\n    [MiddleName] [nvarchar](50) NULL,\n    [NameStyle] [bit] NOT NULL,\n    [Title] [nvarchar](50) NULL,\n    [HireDate] [date] NULL,\n    [BirthDate] [date] NULL,\n    [LoginID] [nvarchar](256) NULL,\n    [EmailAddress] [nvarchar](50) NULL,\n    [Phone] [nvarchar](25) NULL,\n    [MaritalStatus] [nchar](1) NULL,\n    [EmergencyContactName] [nvarchar](50) NULL,\n    [EmergencyContactPhone] [nvarchar](25) NULL,\n    [SalariedFlag] [bit] NULL,\n    [Gender] [nchar](1) NULL,\n    [PayFrequency] [tinyint] NULL,\n    [BaseRate] [money] NULL,\n    [VacationHours] [smallint] NULL,\n    [SickLeaveHours] [smallint] NULL,\n    [CurrentFlag] [bit] NOT NULL,\n    [SalesPersonFlag] [bit] NOT NULL,\n    [DepartmentName] [nvarchar](50) NULL,\n    [StartDate] [date] NULL,\n    [EndDate] [date] NULL,\n    [Status] [nvarchar](50) NULL,\n    [EmployeePhoto] [varbinary](max) NULL\n)\nWITH\n(\n    DISTRIBUTION = REPLICATE,\n    CLUSTERED INDEX (EmployeeKey)\n);\nGO\n\nCREATE TABLE [dbo].[DimProduct_Synapse](\n    [ProductKey] [int] NOT NULL,\n    [ProductAlternateKey] [nvarchar](25) NULL,\n    [ProductSubcategoryKey] [int] NULL,\n    [WeightUnitMeasureCode] [nchar](3) NULL,\n    [SizeUnitMeasureCode] [nchar](3) NULL,\n    [EnglishProductName] [nvarchar](50) NOT NULL,\n    [SpanishProductName] [nvarchar](50) NULL,\n    [FrenchProductName] [nvarchar](50) NULL,\n    [StandardCost] [money] NULL,\n    [FinishedGoodsFlag] [bit] NOT NULL,\n    [Color] [nvarchar](15) NOT NULL,\n    [SafetyStockLevel] [smallint] NULL,\n    [ReorderPoint] [smallint] NULL,\n    [ListPrice] [money] NULL,\n    [Size] [nvarchar](50) NULL,\n    [SizeRange] [nvarchar](50) NULL,\n    [Weight] [float] NULL,\n    [DaysToManufacture] [int] NULL,\n    [ProductLine] [nchar](2) NULL,\n    [DealerPrice] [money] NULL,\n    [Class] [nchar](2) NULL,\n    [Style] [nchar](2) NULL,\n    [ModelName] [nvarchar](50) NULL,\n    [LargePhoto] [varbinary](max) NULL,\n    [EnglishDescription] [nvarchar](400) NULL,\n    [FrenchDescription] [nvarchar](400) NULL,\n    [ChineseDescription] [nvarchar](400) NULL,\n    [ArabicDescription] [nvarchar](400) NULL,\n    [HebrewDescription] [nvarchar](400) NULL,\n    [ThaiDescription] [nvarchar](400) NULL,\n    [GermanDescription] [nvarchar](400) NULL,\n    [JapaneseDescription] [nvarchar](400) NULL,\n    [TurkishDescription] [nvarchar](400) NULL,\n    [StartDate] [datetime] NULL,\n    [EndDate] [datetime] NULL,\n    [Status] [nvarchar](7) NULL    \n)\nWITH\n(\n    DISTRIBUTION = REPLICATE,\n    CLUSTERED INDEX (ProductKey)\n);\nGO\n\nCREATE TABLE [dbo].[DimGeography_Synapse](\n    [GeographyKey] [int] NOT NULL,\n    [City] [nvarchar](30) NULL,\n    [StateProvinceCode] [nvarchar](3) NULL,\n    [StateProvinceName] [nvarchar](50) NULL,\n    [CountryRegionCode] [nvarchar](3) NULL,\n    [EnglishCountryRegionName] [nvarchar](50) NULL,\n    [SpanishCountryRegionName] [nvarchar](50) NULL,\n    [FrenchCountryRegionName] [nvarchar](50) NULL,\n    [PostalCode] [nvarchar](15) NULL,\n    [SalesTerritoryKey] [int] NULL,\n    [IpAddressLocator] [nvarchar](15) NULL\n)\nWITH\n(\n    DISTRIBUTION = REPLICATE,\n    CLUSTERED COLUMNSTORE INDEX\n);\nGO\n\nCREATE TABLE [dbo].[DimProductCategory_Synapse](\n    [ProductCategoryKey] [int] NOT NULL,\n    [ProductCategoryAlternateKey] [int] NULL,\n    [EnglishProductCategoryName] [nvarchar](50) NOT NULL,\n    [SpanishProductCategoryName] [nvarchar](50) NOT NULL,\n    [FrenchProductCategoryName] [nvarchar](50) NOT NULL\n)\nWITH\n(\n    DISTRIBUTION = REPLICATE,\n    CLUSTERED COLUMNSTORE INDEX\n);\nGO\n\nCREATE TABLE [dbo].[DimProductSubcategory_Synapse](\n    [ProductSubcategoryKey] [int] NOT NULL,\n    [ProductSubcategoryAlternateKey] [int] NULL,\n    [EnglishProductSubcategoryName] [nvarchar](50) NOT NULL,\n    [SpanishProductSubcategoryName] [nvarchar](50) NOT NULL,\n    [FrenchProductSubcategoryName] [nvarchar](50) NOT NULL,\n    [ProductCategoryKey] [int] NULL\n)\nWITH\n(\n    DISTRIBUTION = REPLICATE,\n    CLUSTERED COLUMNSTORE INDEX\n);\nGO\n\nCREATE TABLE [dbo].[DimDate_Synapse]\n( \n    [DateKey] [int]  NOT NULL,\n    [DateAltKey] [datetime]  NOT NULL,\n    [CalendarYear] [int]  NOT NULL,\n    [CalendarQuarter] [int]  NOT NULL,\n    [MonthOfYear] [int]  NOT NULL,\n    [MonthName] [nvarchar](15)  NOT NULL,\n    [DayOfMonth] [int]  NOT NULL,\n    [DayOfWeek] [int]  NOT NULL,\n    [DayName] [nvarchar](15)  NOT NULL,\n    [FiscalYear] [int]  NOT NULL,\n    [FiscalQuarter] [int]  NOT NULL\n)\nWITH\n(\n    DISTRIBUTION = REPLICATE,\n    CLUSTERED COLUMNSTORE INDEX\n);\nGO\n\n\nCOPY INTO [dbo].[DimProduct_Synapse]\nFROM 'https://solliancepublicdata.blob.core.windows.net/dataengineering/dp-203/awdata/DimProduct.csv'\nWITH (\n    FILE_TYPE='CSV',\n    FIELDTERMINATOR='|',\n    FIELDQUOTE='',\n    ROWTERMINATOR='\\n',\n    ENCODING = 'UTF16'\n);\nGO\n\nCOPY INTO [dbo].[DimReseller_Synapse]\nFROM 'https://solliancepublicdata.blob.core.windows.net/dataengineering/dp-203/awdata/DimReseller.csv'\nWITH (\n    FILE_TYPE='CSV',\n    FIELDTERMINATOR='|',\n    FIELDQUOTE='',\n    ROWTERMINATOR='\\n',\n    ENCODING = 'UTF16'\n);\nGO\n\nCOPY INTO [dbo].[DimEmployee_Synapse]\nFROM 'https://solliancepublicdata.blob.core.windows.net/dataengineering/dp-203/awdata/DimEmployee.csv'\nWITH (\n    FILE_TYPE='CSV',\n    FIELDTERMINATOR='|',\n    FIELDQUOTE='',\n    ROWTERMINATOR='\\n',\n    ENCODING = 'UTF16'\n);\nGO\n\nCOPY INTO [dbo].[DimGeography_Synapse]\nFROM 'https://solliancepublicdata.blob.core.windows.net/dataengineering/dp-203/awdata/DimGeography.csv'\nWITH (\n    FILE_TYPE='CSV',\n    FIELDTERMINATOR='|',\n    FIELDQUOTE='',\n    ROWTERMINATOR='\\n',\n    ENCODING = 'UTF16'\n);\nGO\n\nCOPY INTO [dbo].[FactResellerSales_Synapse]\nFROM 'https://solliancepublicdata.blob.core.windows.net/dataengineering/dp-203/awdata/FactResellerSales.csv'\nWITH (\n    FILE_TYPE='CSV',\n    FIELDTERMINATOR='|',\n    FIELDQUOTE='',\n    ROWTERMINATOR='\\n',\n    ENCODING = 'UTF16'\n);\nGO\n\n\nCOPY INTO [dbo].[DimProductCategory_Synapse]\nFROM 'https://solliancepublicdata.blob.core.windows.net/dataengineering/dp-203/awdata/DimProductCategory.csv'\nWITH (\n    FILE_TYPE='CSV',\n    FIELDTERMINATOR='|',\n    FIELDQUOTE='',\n    ROWTERMINATOR='\\n',\n    ENCODING = 'UTF16'\n);\nGO\n\nCOPY INTO [dbo].[DimProductSubcategory_Synapse]\nFROM 'https://solliancepublicdata.blob.core.windows.net/dataengineering/dp-203/awdata/DimProductSubcategory.csv'\nWITH (\n    FILE_TYPE='CSV',\n    FIELDTERMINATOR='|',\n    FIELDQUOTE='',\n    ROWTERMINATOR='\\n',\n    ENCODING = 'UTF16'\n);\nGO\n\nCOPY INTO [dbo].[DimDate_Synapse]\nFROM 'https://solliancepublicdata.blob.core.windows.net/dataengineering/dp-203/awdata/DimDate.csv'\nWITH (\n    FILE_TYPE='CSV',\n    FIELDTERMINATOR='|',\n    FIELDQUOTE='',\n    ROWTERMINATOR='0x0a',\n    ENCODING = 'UTF16'\n);\nGO\n\n\nSELECT\n    Coalesce(p.[ModelName], p.[EnglishProductName]) AS [Model]\n    ,g.City AS ResellerCity\n    ,g.StateProvinceName AS StateProvince\n    ,Year(f.OrderDate) AS CalendarYear\n    ,CASE\n        WHEN Month(f.OrderDate) < 7 THEN Year(f.OrderDate)\n        ELSE Year(f.OrderDate) + 1\n    END AS FiscalYear -- Fiscal year runs from Jul to June)\n    ,Month(f.OrderDate) AS [Month]\n    ,Sum(f.OrderQuantity) AS Quantity\n    ,Sum(f.ExtendedAmount) AS Amount\n    ,Approx_count_distinct(f.SalesOrderNumber) AS UniqueOrders  \n    ,count(DISTINCT f.SalesOrderNumber) AS DistinctOrders \nFROM\n    [dbo].[FactResellerSales_Synapse] f\nINNER JOIN [dbo].[DimReseller_Synapse] r\n    ON f.ResellerKey = r.ResellerKey\nINNER JOIN [dbo].[DimGeography_Synapse] g\n    ON r.GeographyKey = g.GeographyKey\nINNER JOIN [dbo].[DimProduct_Synapse] p\n    ON f.[ProductKey] = p.[ProductKey]\nGROUP BY\n    Coalesce(p.[ModelName], p.[EnglishProductName])\n    ,g.City\n    ,g.StateProvinceName\n    ,Year(f.OrderDate)\n    ,CASE\n        WHEN Month(f.OrderDate) < 7 THEN Year(f.OrderDate)\n        ELSE Year(f.OrderDate) + 1\n    END\n    ,Month(f.OrderDate)\nORDER BY Amount DESC;\n\n\n\nSELECT\n    pc.EnglishProductCategoryName AS ProductCategory\n    ,psc.EnglishProductSubcategoryName AS ProductSubcategory\n    ,Year(f.OrderDate) AS CalendarYear\n    ,CASE\n        WHEN Month(f.OrderDate) < 7 THEN Year(f.OrderDate)\n        ELSE Year(f.OrderDate) + 1\n    END AS FiscalYear -- Fiscal year runs from Jul to June)\n    ,Month(f.OrderDate) AS [Month]\n    ,Sum(f.OrderQuantity) AS Quantity\n    ,Sum(f.ExtendedAmount) AS Amount\n    ,Approx_count_distinct(f.SalesOrderNumber) AS UniqueOrders  \n    ,count(DISTINCT f.SalesOrderNumber) AS DistinctOrders \nFROM\n    [dbo].[FactResellerSales_Synapse] f\nINNER JOIN [dbo].[DimProduct_Synapse] p\n    ON f.[ProductKey] = p.[ProductKey]\nINNER JOIN [dbo].[DimProductSubcategory_Synapse] psc\n    ON p.[ProductSubcategoryKey] = psc.[ProductSubcategoryKey]\nINNER JOIN [dbo].[DimProductCategory_Synapse] pc\n    ON psc.[ProductCategoryKey] = pc.[ProductCategoryKey]\nGROUP BY\n    pc.EnglishProductCategoryName\n    ,psc.EnglishProductSubcategoryName\n    ,Year(f.OrderDate)\n    ,CASE\n        WHEN Month(f.OrderDate) < 7 THEN Year(f.OrderDate)\n        ELSE Year(f.OrderDate) + 1\n    END\n    ,Month(f.OrderDate)\nORDER BY Amount DESC;\n\n\nSELECT\n    Coalesce(p.[ModelName], p.[EnglishProductName]) AS [Model]\n    ,g.City AS ResellerCity\n    ,g.StateProvinceName AS StateProvince\n    ,d.[CalendarYear]\n    ,d.[FiscalYear]\n    ,d.[MonthOfYear] AS [Month]\n    ,sum(f.OrderQuantity) AS Quantity\n    ,sum(f.ExtendedAmount) AS Amount\n    ,approx_count_distinct(f.SalesOrderNumber) AS UniqueOrders  \n    ,count(DISTINCT f.SalesOrderNumber) AS DistinctOrders \nFROM\n    [dbo].[FactResellerSales_Synapse] f\nINNER JOIN [dbo].[DimReseller_Synapse] r\n    ON f.ResellerKey = r.ResellerKey\nINNER JOIN [dbo].[DimGeography_Synapse] g\n    ON r.GeographyKey = g.GeographyKey\nINNER JOIN [dbo].[DimDate_Synapse] d\n    ON f.[OrderDateKey] = d.[DateKey]\nINNER JOIN [dbo].[DimProduct_Synapse] p\n    ON f.[ProductKey] = p.[ProductKey]\nWHERE d.[MonthOfYear] = 10 AND d.[FiscalYear] IN (2012, 2013)\nGROUP BY\n    Coalesce(p.[ModelName], p.[EnglishProductName])\n    ,g.City\n    ,g.StateProvinceName\n    ,d.[CalendarYear]\n    ,d.[FiscalYear]\n    ,d.[MonthOfYear]\nORDER BY d.[FiscalYear];\n\n\nSELECT name, is_auto_create_stats_on\nFROM sys.databases\n\nselect top 10 * \nfrom \n    openrowset( \n        bulk 'https://pandemicdatalake.blob.core.windows.net/public/curated/covid-19/ecdc_cases/latest/ecdc_cases.jsonl', \n        format = 'csv', \n        fieldterminator ='0x0b', \n        fieldquote = '0x0b' \n    ) with (doc nvarchar(max)) as rows;\n\n\nselect top 10 * \nfrom \n    openrowset( \n        bulk 'https://pandemicdatalake.blob.core.windows.net/public/curated/covid-19/ecdc_cases/latest/ecdc_cases.json', \n        format = 'csv', \n        fieldterminator ='0x0b', \n        fieldquote = '0x0b', \n        rowterminator = '0x0b' --> You need to override rowterminator to read classic JSON \n    ) with (doc nvarchar(max)) as rows;\n\n\nselect top 10 * \nfrom \n    openrowset( \n        bulk 'https://pandemicdatalake.blob.core.windows.net/public/curated/covid-19/ecdc_cases/latest/ecdc_cases.json', \n        format = 'csv', \n        fieldterminator ='0x0b', \n        fieldquote = '0x0b', \n        rowterminator = '0x0b' --> You need to override rowterminator to read classic JSON \n    ) with (doc nvarchar(max)) as rows;\n\n\ncreate external data source covid \nwith (location = 'https://pandemicdatalake.blob.core.windows.net/public/curated/covid-19/ecdc_cases');\ngo \nselect top 10 * \nfrom \n    openrowset( \n        bulk 'latest/ecdc_cases.jsonl', \n        data_source = 'covid', \n        format = 'csv', \n        fieldterminator ='0x0b', \n        fieldquote = '0x0b' \n    ) with (doc nvarchar(max)) as rows \ngo \nselect top 10 * \nfrom \n    openrowset( \n        bulk 'latest/ecdc_cases.json', \n        data_source = 'covid', \n        format = 'csv', \n        fieldterminator ='0x0b', \n        fieldquote = '0x0b', \n        rowterminator = '0x0b' --> You need to override rowterminator to read classic JSON \n    ) with (doc nvarchar(max)) as rows;\n\n\n-- Other Active Connections\nSELECT * FROM sys.dm_pdw_exec_sessions where status <> 'Closed' and session_id <> session_id();   \n\n\n-- Monitor active queries\nSELECT *\nFROM sys.dm_pdw_exec_requests\nWHERE status not in ('Completed','Failed','Cancelled')\n  AND session_id <> session_id()\nORDER BY submit_time DESC;\n\n-- Find top 10 queries longest running queries\nSELECT TOP 10 *\nFROM sys.dm_pdw_exec_requests\nORDER BY total_elapsed_time DESC;\n\n\n-- Find data skew for a distributed table\nDBCC PDW_SHOWSPACEUSED('dbo.FactInternetSales');\n\n\nCREATE VIEW [dbo].[vTableSizes]\nAS\nWITH base\nAS\n(\nSELECT\n    GETDATE()                                                              AS  [execution_time]\n    , DB_NAME()                                                            AS  [database_name]\n    , s.name                                                               AS  [schema_name]\n    , t.name                                                               AS  [table_name]\n    , QUOTENAME(s.name)+'.'+QUOTENAME(t.name)                              AS  [two_part_name]\n    , nt.[name]                                                            AS  [node_table_name]\n    , ROW_NUMBER() OVER(PARTITION BY nt.[name] ORDER BY (SELECT NULL))     AS  [node_table_name_seq]\n    , tp.[distribution_policy_desc]                                        AS  [distribution_policy_name]\n    , c.[name]                                                             AS  [distribution_column]\n    , nt.[distribution_id]                                                 AS  [distribution_id]\n    , i.[type]                                                             AS  [index_type]\n    , i.[type_desc]                                                        AS  [index_type_desc]\n    , nt.[pdw_node_id]                                                     AS  [pdw_node_id]\n    , pn.[type]                                                            AS  [pdw_node_type]\n    , pn.[name]                                                            AS  [pdw_node_name]\n    , di.name                                                              AS  [dist_name]\n    , di.position                                                          AS  [dist_position]\n    , nps.[partition_number]                                               AS  [partition_nmbr]\n    , nps.[reserved_page_count]                                            AS  [reserved_space_page_count]\n    , nps.[reserved_page_count] - nps.[used_page_count]                    AS  [unused_space_page_count]\n    , nps.[in_row_data_page_count]\n        + nps.[row_overflow_used_page_count]\n        + nps.[lob_used_page_count]                                        AS  [data_space_page_count]\n    , nps.[reserved_page_count]\n    - (nps.[reserved_page_count] - nps.[used_page_count])\n    - ([in_row_data_page_count]\n            + [row_overflow_used_page_count]+[lob_used_page_count])        AS  [index_space_page_count]\n    , nps.[row_count]                                                      AS  [row_count]\nFROM\n    sys.schemas s\nINNER JOIN sys.tables t\n    ON s.[schema_id] = t.[schema_id]\nINNER JOIN sys.indexes i\n    ON  t.[object_id] = i.[object_id]\n    AND i.[index_id] <= 1\nINNER JOIN sys.pdw_table_distribution_properties tp\n    ON t.[object_id] = tp.[object_id]\nINNER JOIN sys.pdw_table_mappings tm\n    ON t.[object_id] = tm.[object_id]\nINNER JOIN sys.pdw_nodes_tables nt\n    ON tm.[physical_name] = nt.[name]\nINNER JOIN sys.dm_pdw_nodes pn\n    ON  nt.[pdw_node_id] = pn.[pdw_node_id]\nINNER JOIN sys.pdw_distributions di\n    ON  nt.[distribution_id] = di.[distribution_id]\nINNER JOIN sys.dm_pdw_nodes_db_partition_stats nps\n    ON nt.[object_id] = nps.[object_id]\n    AND nt.[pdw_node_id] = nps.[pdw_node_id]\n    AND nt.[distribution_id] = nps.[distribution_id]\nLEFT OUTER JOIN (select * from sys.pdw_column_distribution_properties where distribution_ordinal = 1) cdp\n    ON t.[object_id] = cdp.[object_id]\nLEFT OUTER JOIN sys.columns c\n    ON cdp.[object_id] = c.[object_id]\n    AND cdp.[column_id] = c.[column_id]\nWHERE pn.[type] = 'COMPUTE'\n)\n, size\nAS\n(\nSELECT\n[execution_time]\n,  [database_name]\n,  [schema_name]\n,  [table_name]\n,  [two_part_name]\n,  [node_table_name]\n,  [node_table_name_seq]\n,  [distribution_policy_name]\n,  [distribution_column]\n,  [distribution_id]\n,  [index_type]\n,  [index_type_desc]\n,  [pdw_node_id]\n,  [pdw_node_type]\n,  [pdw_node_name]\n,  [dist_name]\n,  [dist_position]\n,  [partition_nmbr]\n,  [reserved_space_page_count]\n,  [unused_space_page_count]\n,  [data_space_page_count]\n,  [index_space_page_count]\n,  [row_count]\n,  ([reserved_space_page_count] * 8.0)                                 AS [reserved_space_KB]\n,  ([reserved_space_page_count] * 8.0)/1000                            AS [reserved_space_MB]\n,  ([reserved_space_page_count] * 8.0)/1000000                         AS [reserved_space_GB]\n,  ([reserved_space_page_count] * 8.0)/1000000000                      AS [reserved_space_TB]\n,  ([unused_space_page_count]   * 8.0)                                 AS [unused_space_KB]\n,  ([unused_space_page_count]   * 8.0)/1000                            AS [unused_space_MB]\n,  ([unused_space_page_count]   * 8.0)/1000000                         AS [unused_space_GB]\n,  ([unused_space_page_count]   * 8.0)/1000000000                      AS [unused_space_TB]\n,  ([data_space_page_count]     * 8.0)                                 AS [data_space_KB]\n,  ([data_space_page_count]     * 8.0)/1000                            AS [data_space_MB]\n,  ([data_space_page_count]     * 8.0)/1000000                         AS [data_space_GB]\n,  ([data_space_page_count]     * 8.0)/1000000000                      AS [data_space_TB]\n,  ([index_space_page_count]  * 8.0)                                   AS [index_space_KB]\n,  ([index_space_page_count]  * 8.0)/1000                              AS [index_space_MB]\n,  ([index_space_page_count]  * 8.0)/1000000                           AS [index_space_GB]\n,  ([index_space_page_count]  * 8.0)/1000000000                        AS [index_space_TB]\nFROM base\n)\nSELECT *\nFROM size;\n\n\n\n\nSELECT\n    database_name\n,    schema_name\n,    table_name\n,    distribution_policy_name\n,      distribution_column\n,    index_type_desc\n,    COUNT(distinct partition_nmbr) as nbr_partitions\n,    SUM(row_count)                 as table_row_count\n,    SUM(reserved_space_GB)         as table_reserved_space_GB\n,    SUM(data_space_GB)             as table_data_space_GB\n,    SUM(index_space_GB)            as table_index_space_GB\n,    SUM(unused_space_GB)           as table_unused_space_GB\nFROM\n    [dbo].[vTableSizes]\nWHERE\n    schema_name = 'dbo'\nGROUP BY\n    database_name\n,    schema_name\n,    table_name\n,    distribution_policy_name\n,      distribution_column\n,    index_type_desc\nORDER BY\n    table_reserved_space_GB desc\n\n\ncreate view [dbo].[vColumnStoreRowGroupStats]\nas\nwith cte\nas\n(\nselect   tb.[name]                    AS [logical_table_name]\n,        rg.[row_group_id]            AS [row_group_id]\n,        rg.[state]                   AS [state]\n,        rg.[state_desc]              AS [state_desc]\n,        rg.[total_rows]              AS [total_rows]\n,        rg.[trim_reason_desc]        AS trim_reason_desc\n,        mp.[physical_name]           AS physical_name\nFROM    sys.[schemas] sm\nJOIN    sys.[tables] tb               ON  sm.[schema_id]          = tb.[schema_id]\nJOIN    sys.[pdw_table_mappings] mp   ON  tb.[object_id]          = mp.[object_id]\nJOIN    sys.[pdw_nodes_tables] nt     ON  nt.[name]               = mp.[physical_name]\nJOIN    sys.[dm_pdw_nodes_db_column_store_row_group_physical_stats] rg      ON  rg.[object_id]     = nt.[object_id]\n                                                                            AND rg.[pdw_node_id]   = nt.[pdw_node_id]\n                                        AND rg.[distribution_id]    = nt.[distribution_id]\n)\nselect *\nfrom cte;\n\n\nSELECT\n    *\nFROM\n    [dbo].[vColumnStoreRowGroupStats]\nWHERE\n    Logical_Table_Name = 'FactResellerSales_Synapse';\n\n\n",
					"metadata": {
						"language": "sql"
					},
					"currentConnection": {
						"poolName": "dwtest01",
						"databaseName": "dwtest01"
					},
					"resultLimit": 5000
				},
				"type": "SqlQuery"
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('workspaceName'), '/Load data in spark notebooks')]",
			"type": "Microsoft.Synapse/workspaces/notebooks",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"nbformat": 4,
				"nbformat_minor": 2,
				"bigDataPool": {
					"referenceName": "Sparkpool01",
					"type": "BigDataPoolReference"
				},
				"sessionProperties": {
					"driverMemory": "28g",
					"driverCores": 4,
					"executorMemory": "28g",
					"executorCores": 4,
					"numExecutors": 2,
					"conf": {
						"spark.dynamicAllocation.enabled": "false",
						"spark.dynamicAllocation.minExecutors": "2",
						"spark.dynamicAllocation.maxExecutors": "2"
					}
				},
				"metadata": {
					"saveOutput": true,
					"synapse_widget": {
						"version": "0.1",
						"state": {
							"becea5e0-438d-4342-b92a-8605c889b69a": {
								"type": "Synapse.DataFrame",
								"sync_state": {
									"table": {
										"rows": [
											{
												"TipAmount": 0,
												"PickupTimeID": 63879,
												"PickupLongitude": -73.9513,
												"DropoffTimeID": 64392,
												"TollsAmount": 0,
												"TotalAmount": 9,
												"PickupLatLong": "40.8124,-73.9513",
												"TripDistanceMiles": 1.3,
												"PickupGeographyID": 172348,
												"DropoffGeographyID": 219532,
												"TripDurationSeconds": 513,
												"SurchargeAmount": 1,
												"DateID": 20131231,
												"DropoffLatLong": "40.7982,-73.9444",
												"DropoffLongitude": -73.9444,
												"TaxAmount": 0.5,
												"DropoffLatitude": 40.7982,
												"PickupLatitude": 40.8124,
												"HackneyLicenseID": 35117,
												"PassengerCount": 1,
												"PaymentType": "CSH",
												"FareAmount": 7.5,
												"MedallionID": 10624
											},
											{
												"TipAmount": 0,
												"PickupTimeID": 61733,
												"PickupLongitude": -73.9857,
												"DropoffTimeID": 62114,
												"TollsAmount": 0,
												"TotalAmount": 8.5,
												"PickupLatLong": "40.7352,-73.9857",
												"TripDistanceMiles": 1.3,
												"PickupGeographyID": 87083,
												"DropoffGeographyID": 137768,
												"TripDurationSeconds": 380,
												"SurchargeAmount": 1,
												"DateID": 20131231,
												"DropoffLatLong": "40.751,-73.9789",
												"DropoffLongitude": -73.9789,
												"TaxAmount": 0.5,
												"DropoffLatitude": 40.751,
												"PickupLatitude": 40.7352,
												"HackneyLicenseID": 11597,
												"PassengerCount": 1,
												"PaymentType": "CSH",
												"FareAmount": 7,
												"MedallionID": 7263
											},
											{
												"TipAmount": 0,
												"PickupTimeID": 59488,
												"PickupLongitude": -73.9483,
												"DropoffTimeID": 59815,
												"TollsAmount": 0,
												"TotalAmount": 7.5,
												"PickupLatLong": "40.7699,-73.9483",
												"TripDistanceMiles": 1,
												"PickupGeographyID": 82160,
												"DropoffGeographyID": 146431,
												"TripDurationSeconds": 326,
												"SurchargeAmount": 1,
												"DateID": 20131231,
												"DropoffLatLong": "40.763,-73.962",
												"DropoffLongitude": -73.962,
												"TaxAmount": 0.5,
												"DropoffLatitude": 40.763,
												"PickupLatitude": 40.7699,
												"HackneyLicenseID": 5301,
												"PassengerCount": 1,
												"PaymentType": "CSH",
												"FareAmount": 6,
												"MedallionID": 1899
											},
											{
												"TipAmount": 0,
												"PickupTimeID": 69093,
												"PickupLongitude": -73.9746,
												"DropoffTimeID": 69548,
												"TollsAmount": 0,
												"TotalAmount": 8.5,
												"PickupLatLong": "40.7507,-73.9746",
												"TripDistanceMiles": 1,
												"PickupGeographyID": 276342,
												"DropoffGeographyID": 43408,
												"TripDurationSeconds": 454,
												"SurchargeAmount": 1,
												"DateID": 20131231,
												"DropoffLatLong": "40.7428,-73.9823",
												"DropoffLongitude": -73.9823,
												"TaxAmount": 0.5,
												"DropoffLatitude": 40.7428,
												"PickupLatitude": 40.7507,
												"HackneyLicenseID": 28727,
												"PassengerCount": 1,
												"PaymentType": "CSH",
												"FareAmount": 7,
												"MedallionID": 9471
											},
											{
												"TipAmount": 0,
												"PickupTimeID": 51720,
												"PickupLongitude": -74.0119,
												"DropoffTimeID": 52440,
												"TollsAmount": 0,
												"TotalAmount": 20,
												"PickupLatLong": "40.7138,-74.0119",
												"TripDistanceMiles": 6.11,
												"PickupGeographyID": 155260,
												"DropoffGeographyID": 211054,
												"TripDurationSeconds": 720,
												"SurchargeAmount": 0,
												"DateID": 20131231,
												"DropoffLatLong": "40.7494,-73.9694",
												"DropoffLongitude": -73.9694,
												"TaxAmount": 0.5,
												"DropoffLatitude": 40.7494,
												"PickupLatitude": 40.7138,
												"HackneyLicenseID": 16124,
												"PassengerCount": 1,
												"PaymentType": "CSH",
												"FareAmount": 19.5,
												"MedallionID": 2556
											},
											{
												"TipAmount": 0,
												"PickupTimeID": 31260,
												"PickupLongitude": -73.9773,
												"DropoffTimeID": 32100,
												"TollsAmount": 0,
												"TotalAmount": 12,
												"PickupLatLong": "40.726,-73.9773",
												"TripDistanceMiles": 2.16,
												"PickupGeographyID": 263305,
												"DropoffGeographyID": 80576,
												"TripDurationSeconds": 840,
												"SurchargeAmount": 0,
												"DateID": 20131231,
												"DropoffLatLong": "40.749,-73.9838",
												"DropoffLongitude": -73.9838,
												"TaxAmount": 0.5,
												"DropoffLatitude": 40.749,
												"PickupLatitude": 40.726,
												"HackneyLicenseID": 33809,
												"PassengerCount": 1,
												"PaymentType": "CSH",
												"FareAmount": 11.5,
												"MedallionID": 1433
											},
											{
												"TipAmount": 0,
												"PickupTimeID": 18150,
												"PickupLongitude": -74.008,
												"DropoffTimeID": 20112,
												"TollsAmount": 0,
												"TotalAmount": 33,
												"PickupLatLong": "40.7421,-74.008",
												"TripDistanceMiles": 9.2,
												"PickupGeographyID": 26661,
												"DropoffGeographyID": 108578,
												"TripDurationSeconds": 1962,
												"SurchargeAmount": 0.5,
												"DateID": 20131231,
												"DropoffLatLong": "40.757,-73.8866",
												"DropoffLongitude": -73.8866,
												"TaxAmount": 0.5,
												"DropoffLatitude": 40.757,
												"PickupLatitude": 40.7421,
												"HackneyLicenseID": 7842,
												"PassengerCount": 1,
												"PaymentType": "CSH",
												"FareAmount": 32,
												"MedallionID": 1486
											},
											{
												"TipAmount": 0,
												"PickupTimeID": 37020,
												"PickupLongitude": -73.8637,
												"DropoffTimeID": 38460,
												"TollsAmount": 0,
												"TotalAmount": 41,
												"PickupLatLong": "40.7697,-73.8637",
												"TripDistanceMiles": 14.78,
												"PickupGeographyID": 147003,
												"DropoffGeographyID": 70493,
												"TripDurationSeconds": 1440,
												"SurchargeAmount": 0,
												"DateID": 20131231,
												"DropoffLatLong": "40.6519,-74.0064",
												"DropoffLongitude": -74.0064,
												"TaxAmount": 0.5,
												"DropoffLatitude": 40.6519,
												"PickupLatitude": 40.7697,
												"HackneyLicenseID": 36224,
												"PassengerCount": 1,
												"PaymentType": "CSH",
												"FareAmount": 40.5,
												"MedallionID": 7225
											},
											{
												"TipAmount": 4.35,
												"PickupTimeID": 64740,
												"PickupLongitude": -74.0022,
												"DropoffTimeID": 65700,
												"TollsAmount": 0,
												"TotalAmount": 19.35,
												"PickupLatLong": "40.7263,-74.0022",
												"TripDistanceMiles": 3.25,
												"PickupGeographyID": 230937,
												"DropoffGeographyID": 116813,
												"TripDurationSeconds": 960,
												"SurchargeAmount": 1,
												"DateID": 20131231,
												"DropoffLatLong": "40.7555,-73.9729",
												"DropoffLongitude": -73.9729,
												"TaxAmount": 0.5,
												"DropoffLatitude": 40.7555,
												"PickupLatitude": 40.7263,
												"HackneyLicenseID": 35009,
												"PassengerCount": 1,
												"PaymentType": "CRD",
												"FareAmount": 13.5,
												"MedallionID": 8726
											},
											{
												"TipAmount": 3.75,
												"PickupTimeID": 66600,
												"PickupLongitude": -73.9822,
												"DropoffTimeID": 67260,
												"TollsAmount": 0,
												"TotalAmount": 19.25,
												"PickupLatLong": "40.7698,-73.9822",
												"TripDistanceMiles": 3.92,
												"PickupGeographyID": 225983,
												"DropoffGeographyID": 76697,
												"TripDurationSeconds": 660,
												"SurchargeAmount": 1,
												"DateID": 20131231,
												"DropoffLatLong": "40.8166,-73.9605",
												"DropoffLongitude": -73.9605,
												"TaxAmount": 0.5,
												"DropoffLatitude": 40.8166,
												"PickupLatitude": 40.7698,
												"HackneyLicenseID": 30912,
												"PassengerCount": 1,
												"PaymentType": "CRD",
												"FareAmount": 14,
												"MedallionID": 573
											}
										],
										"schema": {
											"DateID": "int",
											"MedallionID": "int",
											"HackneyLicenseID": "int",
											"PickupTimeID": "int",
											"DropoffTimeID": "int",
											"PickupGeographyID": "int",
											"DropoffGeographyID": "int",
											"PickupLatitude": "double",
											"PickupLongitude": "double",
											"PickupLatLong": "string",
											"DropoffLatitude": "double",
											"DropoffLongitude": "double",
											"DropoffLatLong": "string",
											"PassengerCount": "int",
											"TripDurationSeconds": "int",
											"TripDistanceMiles": "double",
											"PaymentType": "string",
											"FareAmount": "decimal",
											"SurchargeAmount": "decimal",
											"TaxAmount": "decimal",
											"TipAmount": "decimal",
											"TollsAmount": "decimal",
											"TotalAmount": "decimal"
										}
									},
									"isSummary": false,
									"language": "scala"
								},
								"persist_state": {
									"view": {
										"type": "details",
										"chartOptions": {
											"chartType": "bar",
											"aggregationType": "sum",
											"categoryFieldKeys": [
												"MedallionID"
											],
											"seriesFieldKeys": [
												"DateID"
											],
											"isStacked": false
										}
									}
								}
							},
							"4b3c58f8-f800-405e-9d68-cd4b2d0f4b3a": {
								"type": "Synapse.DataFrame",
								"sync_state": {
									"table": {
										"rows": [
											{
												"(sum)TotalAmount": 39894.86,
												"DateID": 20131217,
												"(sum)PassengerCount": 3904,
												"(avg)PassengerCount": 1.5685,
												"PaymentType": "CRD"
											},
											{
												"(sum)TotalAmount": 17735.16,
												"DateID": 20131217,
												"(sum)PassengerCount": 2521,
												"(avg)PassengerCount": 1.6919,
												"PaymentType": "CSH"
											},
											{
												"(sum)TotalAmount": 119.92,
												"DateID": 20131217,
												"(sum)PassengerCount": 13,
												"(avg)PassengerCount": 1.625,
												"PaymentType": "UNK"
											},
											{
												"(sum)TotalAmount": 30,
												"DateID": 20131217,
												"(sum)PassengerCount": 3,
												"(avg)PassengerCount": 1,
												"PaymentType": "NOC"
											},
											{
												"(sum)TotalAmount": 22.5,
												"DateID": 20131217,
												"(sum)PassengerCount": 2,
												"(avg)PassengerCount": 1,
												"PaymentType": "DIS"
											},
											{
												"(sum)TotalAmount": 86479.27,
												"DateID": 20131218,
												"(sum)PassengerCount": 7714,
												"(avg)PassengerCount": 1.6071,
												"PaymentType": "CRD"
											},
											{
												"(sum)TotalAmount": 45860.06,
												"DateID": 20131218,
												"(sum)PassengerCount": 6415,
												"(avg)PassengerCount": 1.8498,
												"PaymentType": "CSH"
											},
											{
												"(sum)TotalAmount": 380.85,
												"DateID": 20131218,
												"(sum)PassengerCount": 51,
												"(avg)PassengerCount": 1.7,
												"PaymentType": "UNK"
											},
											{
												"(sum)TotalAmount": 149.5,
												"DateID": 20131218,
												"(sum)PassengerCount": 9,
												"(avg)PassengerCount": 1.2857,
												"PaymentType": "NOC"
											},
											{
												"(sum)TotalAmount": 53,
												"DateID": 20131218,
												"(sum)PassengerCount": 3,
												"(avg)PassengerCount": 1.5,
												"PaymentType": "DIS"
											},
											{
												"(sum)TotalAmount": 88255.75,
												"DateID": 20131219,
												"(sum)PassengerCount": 7805,
												"(avg)PassengerCount": 1.6037,
												"PaymentType": "CRD"
											},
											{
												"(sum)TotalAmount": 39,
												"DateID": 20131219,
												"(sum)PassengerCount": 4,
												"(avg)PassengerCount": 1.3333,
												"PaymentType": "DIS"
											},
											{
												"(sum)TotalAmount": 128.33,
												"DateID": 20131219,
												"(sum)PassengerCount": 19,
												"(avg)PassengerCount": 1.3571,
												"PaymentType": "NOC"
											},
											{
												"(sum)TotalAmount": 49503.96,
												"DateID": 20131219,
												"(sum)PassengerCount": 6739,
												"(avg)PassengerCount": 1.8352,
												"PaymentType": "CSH"
											},
											{
												"(sum)TotalAmount": 353.67,
												"DateID": 20131219,
												"(sum)PassengerCount": 39,
												"(avg)PassengerCount": 1.8571,
												"PaymentType": "UNK"
											},
											{
												"(sum)TotalAmount": 85998.56,
												"DateID": 20131220,
												"(sum)PassengerCount": 7491,
												"(avg)PassengerCount": 1.56,
												"PaymentType": "CRD"
											},
											{
												"(sum)TotalAmount": 51564.75,
												"DateID": 20131220,
												"(sum)PassengerCount": 7222,
												"(avg)PassengerCount": 1.8191,
												"PaymentType": "CSH"
											},
											{
												"(sum)TotalAmount": 255.33,
												"DateID": 20131220,
												"(sum)PassengerCount": 37,
												"(avg)PassengerCount": 1.9474,
												"PaymentType": "UNK"
											},
											{
												"(sum)TotalAmount": 143.83,
												"DateID": 20131220,
												"(sum)PassengerCount": 19,
												"(avg)PassengerCount": 1.3571,
												"PaymentType": "NOC"
											},
											{
												"(sum)TotalAmount": 50.83,
												"DateID": 20131220,
												"(sum)PassengerCount": 3,
												"(avg)PassengerCount": 1,
												"PaymentType": "DIS"
											},
											{
												"(sum)TotalAmount": 61078.2,
												"DateID": 20131221,
												"(sum)PassengerCount": 5873,
												"(avg)PassengerCount": 1.6007,
												"PaymentType": "CRD"
											},
											{
												"(sum)TotalAmount": 48749.31,
												"DateID": 20131221,
												"(sum)PassengerCount": 7730,
												"(avg)PassengerCount": 1.9545,
												"PaymentType": "CSH"
											},
											{
												"(sum)TotalAmount": 290,
												"DateID": 20131221,
												"(sum)PassengerCount": 27,
												"(avg)PassengerCount": 1.2857,
												"PaymentType": "NOC"
											},
											{
												"(sum)TotalAmount": 207.66,
												"DateID": 20131221,
												"(sum)PassengerCount": 38,
												"(avg)PassengerCount": 2.7143,
												"PaymentType": "UNK"
											},
											{
												"(sum)TotalAmount": 76.33,
												"DateID": 20131221,
												"(sum)PassengerCount": 8,
												"(avg)PassengerCount": 1.6,
												"PaymentType": "DIS"
											},
											{
												"(sum)TotalAmount": 43856.89,
												"DateID": 20131222,
												"(sum)PassengerCount": 6571,
												"(avg)PassengerCount": 1.9592,
												"PaymentType": "CSH"
											},
											{
												"(sum)TotalAmount": 49428.69,
												"DateID": 20131222,
												"(sum)PassengerCount": 4617,
												"(avg)PassengerCount": 1.6436,
												"PaymentType": "CRD"
											},
											{
												"(sum)TotalAmount": 49,
												"DateID": 20131222,
												"(sum)PassengerCount": 4,
												"(avg)PassengerCount": 1.3333,
												"PaymentType": "DIS"
											},
											{
												"(sum)TotalAmount": 170.5,
												"DateID": 20131222,
												"(sum)PassengerCount": 11,
												"(avg)PassengerCount": 1.2222,
												"PaymentType": "NOC"
											},
											{
												"(sum)TotalAmount": 168.33,
												"DateID": 20131222,
												"(sum)PassengerCount": 28,
												"(avg)PassengerCount": 2.5455,
												"PaymentType": "UNK"
											},
											{
												"(sum)TotalAmount": 43210.7,
												"DateID": 20131223,
												"(sum)PassengerCount": 6440,
												"(avg)PassengerCount": 1.8786,
												"PaymentType": "CSH"
											},
											{
												"(sum)TotalAmount": 49558.41,
												"DateID": 20131223,
												"(sum)PassengerCount": 4652,
												"(avg)PassengerCount": 1.5637,
												"PaymentType": "CRD"
											},
											{
												"(sum)TotalAmount": 423.17,
												"DateID": 20131223,
												"(sum)PassengerCount": 41,
												"(avg)PassengerCount": 2.4118,
												"PaymentType": "UNK"
											},
											{
												"(sum)TotalAmount": 64,
												"DateID": 20131223,
												"(sum)PassengerCount": 7,
												"(avg)PassengerCount": 1.75,
												"PaymentType": "DIS"
											},
											{
												"(sum)TotalAmount": 132.33,
												"DateID": 20131223,
												"(sum)PassengerCount": 11,
												"(avg)PassengerCount": 1.2222,
												"PaymentType": "NOC"
											},
											{
												"(sum)TotalAmount": 45436.76,
												"DateID": 20131224,
												"(sum)PassengerCount": 7484,
												"(avg)PassengerCount": 1.9319,
												"PaymentType": "CSH"
											},
											{
												"(sum)TotalAmount": 45203.9,
												"DateID": 20131224,
												"(sum)PassengerCount": 4706,
												"(avg)PassengerCount": 1.6312,
												"PaymentType": "CRD"
											},
											{
												"(sum)TotalAmount": 250.11,
												"DateID": 20131224,
												"(sum)PassengerCount": 28,
												"(avg)PassengerCount": 1.8667,
												"PaymentType": "UNK"
											},
											{
												"(sum)TotalAmount": 106,
												"DateID": 20131224,
												"(sum)PassengerCount": 13,
												"(avg)PassengerCount": 1.1818,
												"PaymentType": "NOC"
											},
											{
												"(sum)TotalAmount": 16,
												"DateID": 20131224,
												"(sum)PassengerCount": 4,
												"(avg)PassengerCount": 1,
												"PaymentType": "DIS"
											},
											{
												"(sum)TotalAmount": 29885.69,
												"DateID": 20131225,
												"(sum)PassengerCount": 3044,
												"(avg)PassengerCount": 1.778,
												"PaymentType": "CRD"
											},
											{
												"(sum)TotalAmount": 38352.94,
												"DateID": 20131225,
												"(sum)PassengerCount": 5933,
												"(avg)PassengerCount": 1.9491,
												"PaymentType": "CSH"
											},
											{
												"(sum)TotalAmount": 174.93,
												"DateID": 20131225,
												"(sum)PassengerCount": 19,
												"(avg)PassengerCount": 1.7273,
												"PaymentType": "UNK"
											},
											{
												"(sum)TotalAmount": 96.83,
												"DateID": 20131225,
												"(sum)PassengerCount": 11,
												"(avg)PassengerCount": 1.375,
												"PaymentType": "NOC"
											},
											{
												"(sum)TotalAmount": 3,
												"DateID": 20131225,
												"(sum)PassengerCount": 1,
												"(avg)PassengerCount": 1,
												"PaymentType": "DIS"
											},
											{
												"(sum)TotalAmount": 33196.46,
												"DateID": 20131226,
												"(sum)PassengerCount": 3369,
												"(avg)PassengerCount": 1.6563,
												"PaymentType": "CRD"
											},
											{
												"(sum)TotalAmount": 37695.26,
												"DateID": 20131226,
												"(sum)PassengerCount": 5973,
												"(avg)PassengerCount": 1.9286,
												"PaymentType": "CSH"
											},
											{
												"(sum)TotalAmount": 182.3,
												"DateID": 20131226,
												"(sum)PassengerCount": 26,
												"(avg)PassengerCount": 1.8571,
												"PaymentType": "UNK"
											},
											{
												"(sum)TotalAmount": 22.83,
												"DateID": 20131226,
												"(sum)PassengerCount": 3,
												"(avg)PassengerCount": 1,
												"PaymentType": "DIS"
											},
											{
												"(sum)TotalAmount": 10,
												"DateID": 20131226,
												"(sum)PassengerCount": 1,
												"(avg)PassengerCount": 1,
												"PaymentType": "NOC"
											},
											{
												"(sum)TotalAmount": 48647.42,
												"DateID": 20131227,
												"(sum)PassengerCount": 7586,
												"(avg)PassengerCount": 1.9689,
												"PaymentType": "CSH"
											},
											{
												"(sum)TotalAmount": 37806.13,
												"DateID": 20131227,
												"(sum)PassengerCount": 3798,
												"(avg)PassengerCount": 1.6328,
												"PaymentType": "CRD"
											},
											{
												"(sum)TotalAmount": 151.99,
												"DateID": 20131227,
												"(sum)PassengerCount": 9,
												"(avg)PassengerCount": 1.2857,
												"PaymentType": "NOC"
											},
											{
												"(sum)TotalAmount": 284.9,
												"DateID": 20131227,
												"(sum)PassengerCount": 20,
												"(avg)PassengerCount": 1.25,
												"PaymentType": "UNK"
											},
											{
												"(sum)TotalAmount": 11,
												"DateID": 20131227,
												"(sum)PassengerCount": 7,
												"(avg)PassengerCount": 2.3333,
												"PaymentType": "DIS"
											},
											{
												"(sum)TotalAmount": 43495.35,
												"DateID": 20131228,
												"(sum)PassengerCount": 4289,
												"(avg)PassengerCount": 1.6754,
												"PaymentType": "CRD"
											},
											{
												"(sum)TotalAmount": 46986.03,
												"DateID": 20131228,
												"(sum)PassengerCount": 6988,
												"(avg)PassengerCount": 1.9818,
												"PaymentType": "CSH"
											},
											{
												"(sum)TotalAmount": 224.8,
												"DateID": 20131228,
												"(sum)PassengerCount": 28,
												"(avg)PassengerCount": 2.8,
												"PaymentType": "UNK"
											},
											{
												"(sum)TotalAmount": 51,
												"DateID": 20131228,
												"(sum)PassengerCount": 8,
												"(avg)PassengerCount": 2,
												"PaymentType": "DIS"
											},
											{
												"(sum)TotalAmount": 107.16,
												"DateID": 20131228,
												"(sum)PassengerCount": 5,
												"(avg)PassengerCount": 1.25,
												"PaymentType": "NOC"
											},
											{
												"(sum)TotalAmount": 48735.5,
												"DateID": 20131229,
												"(sum)PassengerCount": 7704,
												"(avg)PassengerCount": 1.9835,
												"PaymentType": "CSH"
											},
											{
												"(sum)TotalAmount": 54770.92,
												"DateID": 20131229,
												"(sum)PassengerCount": 5404,
												"(avg)PassengerCount": 1.7188,
												"PaymentType": "CRD"
											},
											{
												"(sum)TotalAmount": 229.16,
												"DateID": 20131229,
												"(sum)PassengerCount": 37,
												"(avg)PassengerCount": 3.3636,
												"PaymentType": "UNK"
											},
											{
												"(sum)TotalAmount": 64,
												"DateID": 20131229,
												"(sum)PassengerCount": 9,
												"(avg)PassengerCount": 1.125,
												"PaymentType": "NOC"
											},
											{
												"(sum)TotalAmount": 16,
												"DateID": 20131229,
												"(sum)PassengerCount": 1,
												"(avg)PassengerCount": 1,
												"PaymentType": "DIS"
											},
											{
												"(sum)TotalAmount": 45358.92,
												"DateID": 20131230,
												"(sum)PassengerCount": 4668,
												"(avg)PassengerCount": 1.6141,
												"PaymentType": "CRD"
											},
											{
												"(sum)TotalAmount": 45715.63,
												"DateID": 20131230,
												"(sum)PassengerCount": 6868,
												"(avg)PassengerCount": 1.9147,
												"PaymentType": "CSH"
											},
											{
												"(sum)TotalAmount": 408.45,
												"DateID": 20131230,
												"(sum)PassengerCount": 53,
												"(avg)PassengerCount": 2.5238,
												"PaymentType": "UNK"
											},
											{
												"(sum)TotalAmount": 48.5,
												"DateID": 20131230,
												"(sum)PassengerCount": 11,
												"(avg)PassengerCount": 1,
												"PaymentType": "NOC"
											},
											{
												"(sum)TotalAmount": 41,
												"DateID": 20131230,
												"(sum)PassengerCount": 2,
												"(avg)PassengerCount": 1,
												"PaymentType": "DIS"
											},
											{
												"(sum)TotalAmount": 47720.3,
												"DateID": 20131231,
												"(sum)PassengerCount": 7900,
												"(avg)PassengerCount": 1.9147,
												"PaymentType": "CSH"
											},
											{
												"(sum)TotalAmount": 48611.43,
												"DateID": 20131231,
												"(sum)PassengerCount": 5330,
												"(avg)PassengerCount": 1.6206,
												"PaymentType": "CRD"
											},
											{
												"(sum)TotalAmount": 291.86,
												"DateID": 20131231,
												"(sum)PassengerCount": 38,
												"(avg)PassengerCount": 2.1111,
												"PaymentType": "UNK"
											},
											{
												"(sum)TotalAmount": 39.5,
												"DateID": 20131231,
												"(sum)PassengerCount": 10,
												"(avg)PassengerCount": 1,
												"PaymentType": "NOC"
											},
											{
												"(sum)TotalAmount": 70,
												"DateID": 20131231,
												"(sum)PassengerCount": 10,
												"(avg)PassengerCount": 1.6667,
												"PaymentType": "DIS"
											}
										],
										"schema": {
											"DateID": "int",
											"PaymentType": "string",
											"(sum)TotalAmount": "decimal",
											"(avg)PassengerCount": "double",
											"(sum)PassengerCount": "bigint"
										}
									},
									"isSummary": false,
									"language": "scala"
								},
								"persist_state": {
									"view": {
										"type": "details",
										"chartOptions": {
											"chartType": "bar",
											"aggregationType": "sum",
											"categoryFieldKeys": [
												"PaymentType"
											],
											"seriesFieldKeys": [
												"DateID"
											],
											"isStacked": false
										}
									}
								}
							},
							"dfb29004-6f6a-4a5c-9b49-4b9a1fd49b5a": {
								"type": "Synapse.DataFrame",
								"sync_state": {
									"table": {
										"rows": [
											{
												"DateID": 20131219,
												"PaymentType": "CRD",
												"(sum)TotalAmount": 88255.75
											},
											{
												"DateID": 20131218,
												"PaymentType": "CRD",
												"(sum)TotalAmount": 86479.27
											},
											{
												"DateID": 20131220,
												"PaymentType": "CRD",
												"(sum)TotalAmount": 85998.56
											},
											{
												"DateID": 20131221,
												"PaymentType": "CRD",
												"(sum)TotalAmount": 61078.2
											},
											{
												"DateID": 20131229,
												"PaymentType": "CRD",
												"(sum)TotalAmount": 54770.92
											},
											{
												"DateID": 20131220,
												"PaymentType": "CSH",
												"(sum)TotalAmount": 51564.75
											},
											{
												"DateID": 20131223,
												"PaymentType": "CRD",
												"(sum)TotalAmount": 49558.41
											},
											{
												"DateID": 20131219,
												"PaymentType": "CSH",
												"(sum)TotalAmount": 49503.96
											},
											{
												"DateID": 20131222,
												"PaymentType": "CRD",
												"(sum)TotalAmount": 49428.69
											},
											{
												"DateID": 20131221,
												"PaymentType": "CSH",
												"(sum)TotalAmount": 48749.31
											},
											{
												"DateID": 20131229,
												"PaymentType": "CSH",
												"(sum)TotalAmount": 48735.5
											},
											{
												"DateID": 20131227,
												"PaymentType": "CSH",
												"(sum)TotalAmount": 48647.42
											},
											{
												"DateID": 20131231,
												"PaymentType": "CRD",
												"(sum)TotalAmount": 48611.43
											},
											{
												"DateID": 20131231,
												"PaymentType": "CSH",
												"(sum)TotalAmount": 47720.3
											},
											{
												"DateID": 20131228,
												"PaymentType": "CSH",
												"(sum)TotalAmount": 46986.03
											},
											{
												"DateID": 20131218,
												"PaymentType": "CSH",
												"(sum)TotalAmount": 45860.06
											},
											{
												"DateID": 20131230,
												"PaymentType": "CSH",
												"(sum)TotalAmount": 45715.63
											},
											{
												"DateID": 20131224,
												"PaymentType": "CSH",
												"(sum)TotalAmount": 45436.76
											},
											{
												"DateID": 20131230,
												"PaymentType": "CRD",
												"(sum)TotalAmount": 45358.92
											},
											{
												"DateID": 20131224,
												"PaymentType": "CRD",
												"(sum)TotalAmount": 45203.9
											},
											{
												"DateID": 20131222,
												"PaymentType": "CSH",
												"(sum)TotalAmount": 43856.89
											},
											{
												"DateID": 20131228,
												"PaymentType": "CRD",
												"(sum)TotalAmount": 43495.35
											},
											{
												"DateID": 20131223,
												"PaymentType": "CSH",
												"(sum)TotalAmount": 43210.7
											},
											{
												"DateID": 20131217,
												"PaymentType": "CRD",
												"(sum)TotalAmount": 39894.86
											},
											{
												"DateID": 20131225,
												"PaymentType": "CSH",
												"(sum)TotalAmount": 38352.94
											},
											{
												"DateID": 20131227,
												"PaymentType": "CRD",
												"(sum)TotalAmount": 37806.13
											},
											{
												"DateID": 20131226,
												"PaymentType": "CSH",
												"(sum)TotalAmount": 37695.26
											},
											{
												"DateID": 20131226,
												"PaymentType": "CRD",
												"(sum)TotalAmount": 33196.46
											},
											{
												"DateID": 20131225,
												"PaymentType": "CRD",
												"(sum)TotalAmount": 29885.69
											},
											{
												"DateID": 20131217,
												"PaymentType": "CSH",
												"(sum)TotalAmount": 17735.16
											},
											{
												"DateID": 20131223,
												"PaymentType": "UNK",
												"(sum)TotalAmount": 423.17
											},
											{
												"DateID": 20131230,
												"PaymentType": "UNK",
												"(sum)TotalAmount": 408.45
											},
											{
												"DateID": 20131218,
												"PaymentType": "UNK",
												"(sum)TotalAmount": 380.85
											},
											{
												"DateID": 20131219,
												"PaymentType": "UNK",
												"(sum)TotalAmount": 353.67
											},
											{
												"DateID": 20131231,
												"PaymentType": "UNK",
												"(sum)TotalAmount": 291.86
											},
											{
												"DateID": 20131221,
												"PaymentType": "NOC",
												"(sum)TotalAmount": 290
											},
											{
												"DateID": 20131227,
												"PaymentType": "UNK",
												"(sum)TotalAmount": 284.9
											},
											{
												"DateID": 20131220,
												"PaymentType": "UNK",
												"(sum)TotalAmount": 255.33
											},
											{
												"DateID": 20131224,
												"PaymentType": "UNK",
												"(sum)TotalAmount": 250.11
											},
											{
												"DateID": 20131229,
												"PaymentType": "UNK",
												"(sum)TotalAmount": 229.16
											},
											{
												"DateID": 20131228,
												"PaymentType": "UNK",
												"(sum)TotalAmount": 224.8
											},
											{
												"DateID": 20131221,
												"PaymentType": "UNK",
												"(sum)TotalAmount": 207.66
											},
											{
												"DateID": 20131226,
												"PaymentType": "UNK",
												"(sum)TotalAmount": 182.3
											},
											{
												"DateID": 20131225,
												"PaymentType": "UNK",
												"(sum)TotalAmount": 174.93
											},
											{
												"DateID": 20131222,
												"PaymentType": "NOC",
												"(sum)TotalAmount": 170.5
											},
											{
												"DateID": 20131222,
												"PaymentType": "UNK",
												"(sum)TotalAmount": 168.33
											},
											{
												"DateID": 20131227,
												"PaymentType": "NOC",
												"(sum)TotalAmount": 151.99
											},
											{
												"DateID": 20131218,
												"PaymentType": "NOC",
												"(sum)TotalAmount": 149.5
											},
											{
												"DateID": 20131220,
												"PaymentType": "NOC",
												"(sum)TotalAmount": 143.83
											},
											{
												"DateID": 20131223,
												"PaymentType": "NOC",
												"(sum)TotalAmount": 132.33
											},
											{
												"DateID": 20131219,
												"PaymentType": "NOC",
												"(sum)TotalAmount": 128.33
											},
											{
												"DateID": 20131217,
												"PaymentType": "UNK",
												"(sum)TotalAmount": 119.92
											},
											{
												"DateID": 20131228,
												"PaymentType": "NOC",
												"(sum)TotalAmount": 107.16
											},
											{
												"DateID": 20131224,
												"PaymentType": "NOC",
												"(sum)TotalAmount": 106
											},
											{
												"DateID": 20131225,
												"PaymentType": "NOC",
												"(sum)TotalAmount": 96.83
											},
											{
												"DateID": 20131221,
												"PaymentType": "DIS",
												"(sum)TotalAmount": 76.33
											},
											{
												"DateID": 20131231,
												"PaymentType": "DIS",
												"(sum)TotalAmount": 70
											},
											{
												"DateID": 20131223,
												"PaymentType": "DIS",
												"(sum)TotalAmount": 64
											},
											{
												"DateID": 20131229,
												"PaymentType": "NOC",
												"(sum)TotalAmount": 64
											},
											{
												"DateID": 20131218,
												"PaymentType": "DIS",
												"(sum)TotalAmount": 53
											},
											{
												"DateID": 20131228,
												"PaymentType": "DIS",
												"(sum)TotalAmount": 51
											},
											{
												"DateID": 20131220,
												"PaymentType": "DIS",
												"(sum)TotalAmount": 50.83
											},
											{
												"DateID": 20131222,
												"PaymentType": "DIS",
												"(sum)TotalAmount": 49
											},
											{
												"DateID": 20131230,
												"PaymentType": "NOC",
												"(sum)TotalAmount": 48.5
											},
											{
												"DateID": 20131230,
												"PaymentType": "DIS",
												"(sum)TotalAmount": 41
											},
											{
												"DateID": 20131231,
												"PaymentType": "NOC",
												"(sum)TotalAmount": 39.5
											},
											{
												"DateID": 20131219,
												"PaymentType": "DIS",
												"(sum)TotalAmount": 39
											},
											{
												"DateID": 20131217,
												"PaymentType": "NOC",
												"(sum)TotalAmount": 30
											},
											{
												"DateID": 20131226,
												"PaymentType": "DIS",
												"(sum)TotalAmount": 22.83
											},
											{
												"DateID": 20131217,
												"PaymentType": "DIS",
												"(sum)TotalAmount": 22.5
											},
											{
												"DateID": 20131224,
												"PaymentType": "DIS",
												"(sum)TotalAmount": 16
											},
											{
												"DateID": 20131229,
												"PaymentType": "DIS",
												"(sum)TotalAmount": 16
											},
											{
												"DateID": 20131227,
												"PaymentType": "DIS",
												"(sum)TotalAmount": 11
											},
											{
												"DateID": 20131226,
												"PaymentType": "NOC",
												"(sum)TotalAmount": 10
											},
											{
												"DateID": 20131225,
												"PaymentType": "DIS",
												"(sum)TotalAmount": 3
											}
										],
										"schema": {
											"DateID": "int",
											"PaymentType": "string",
											"(sum)TotalAmount": "decimal"
										}
									},
									"isSummary": false,
									"language": "scala"
								},
								"persist_state": {
									"view": {
										"type": "details",
										"chartOptions": {
											"chartType": "bar",
											"aggregationType": "sum",
											"categoryFieldKeys": [
												"PaymentType"
											],
											"seriesFieldKeys": [
												"DateID"
											],
											"isStacked": false
										}
									}
								}
							},
							"81da524a-f077-4e92-96bd-8d8fde95ce8a": {
								"type": "Synapse.DataFrame",
								"sync_state": {
									"table": {
										"rows": [
											{
												"DateId": 20131217,
												"totalAmount": 57802.44
											},
											{
												"DateId": 20131218,
												"totalAmount": 132922.68
											},
											{
												"DateId": 20131219,
												"totalAmount": 138280.71
											},
											{
												"DateId": 20131220,
												"totalAmount": 138013.3
											},
											{
												"DateId": 20131221,
												"totalAmount": 110401.5
											},
											{
												"DateId": 20131222,
												"totalAmount": 93673.41
											},
											{
												"DateId": 20131223,
												"totalAmount": 93388.61
											},
											{
												"DateId": 20131224,
												"totalAmount": 91012.77
											},
											{
												"DateId": 20131225,
												"totalAmount": 68513.39
											},
											{
												"DateId": 20131226,
												"totalAmount": 71106.85
											},
											{
												"DateId": 20131227,
												"totalAmount": 86901.44
											},
											{
												"DateId": 20131228,
												"totalAmount": 90864.34
											},
											{
												"DateId": 20131229,
												"totalAmount": 103815.58
											},
											{
												"DateId": 20131230,
												"totalAmount": 91572.5
											},
											{
												"DateId": 20131231,
												"totalAmount": 96733.09
											}
										],
										"schema": {
											"DateId": "int",
											"totalAmount": "decimal"
										}
									},
									"isSummary": false,
									"language": "scala"
								},
								"persist_state": {
									"view": {
										"type": "details",
										"chartOptions": {
											"chartType": "bar",
											"aggregationType": "sum",
											"categoryFieldKeys": [
												"totalAmount"
											],
											"seriesFieldKeys": [
												"DateId"
											],
											"isStacked": false
										}
									}
								}
							}
						}
					},
					"kernelspec": {
						"name": "synapse_pyspark",
						"display_name": "Synapse PySpark"
					},
					"language_info": {
						"name": "python"
					},
					"a365ComputeOptions": {
						"id": "/subscriptions/8759debb-3921-4c79-904d-c0e86b64d530/resourceGroups/zxctest01/providers/Microsoft.Synapse/workspaces/asatest02/bigDataPools/Sparkpool01",
						"name": "Sparkpool01",
						"type": "Spark",
						"endpoint": "https://asatest02.dev.azuresynapse.net/livyApi/versions/2019-11-01-preview/sparkPools/Sparkpool01",
						"auth": {
							"type": "AAD",
							"authResource": "https://dev.azuresynapse.net"
						},
						"sparkVersion": "2.4",
						"nodeCount": 3,
						"cores": 4,
						"memory": 28
					}
				},
				"cells": [
					{
						"cell_type": "code",
						"metadata": {
							"microsoft": {
								"language": "python"
							},
							"collapsed": false
						},
						"source": [
							"%%pyspark\r\n",
							"df = spark.read.load('abfss://myworkspace@adltest02.dfs.core.windows.net/NYCTripSmall.parquet', format='parquet')\r\n",
							"display(df.limit(10))"
						],
						"outputs": [],
						"execution_count": 3
					},
					{
						"cell_type": "code",
						"metadata": {
							"jupyter": {
								"source_hidden": false,
								"outputs_hidden": false
							},
							"nteract": {
								"transient": {
									"deleting": false
								}
							},
							"collapsed": true
						},
						"source": [
							"df.printSchema()"
						],
						"outputs": [],
						"execution_count": 4
					},
					{
						"cell_type": "code",
						"metadata": {
							"jupyter": {
								"source_hidden": false,
								"outputs_hidden": false
							},
							"nteract": {
								"transient": {
									"deleting": false
								}
							},
							"collapsed": false
						},
						"source": [
							"from pyspark.sql import SparkSession\r\n",
							"from pyspark.sql.types import *\r\n",
							"from pyspark.sql.functions import *\r\n",
							"\r\n",
							"profitByDateProduct = (df.groupBy(\"DateID\",\"PaymentType\")\r\n",
							"    .agg(\r\n",
							"        sum(\"TotalAmount\").alias(\"(sum)TotalAmount\"),\r\n",
							"        round(avg(\"PassengerCount\"), 4).alias(\"(avg)PassengerCount\"),\r\n",
							"        sum(\"PassengerCount\").alias(\"(sum)PassengerCount\"))\r\n",
							"    .orderBy(\"DateID\"))\r\n",
							"display(profitByDateProduct.limit(100))"
						],
						"outputs": [],
						"execution_count": 5
					},
					{
						"cell_type": "code",
						"metadata": {
							"jupyter": {
								"source_hidden": false,
								"outputs_hidden": false
							},
							"nteract": {
								"transient": {
									"deleting": false
								}
							},
							"collapsed": true
						},
						"source": [
							"# create a view called user_profiles\r\n",
							"profitByDateProduct.createOrReplaceTempView(\"NYCTripSmall\")"
						],
						"outputs": [],
						"execution_count": 6
					},
					{
						"cell_type": "code",
						"metadata": {
							"jupyter": {
								"source_hidden": false,
								"outputs_hidden": false
							},
							"nteract": {
								"transient": {
									"deleting": false
								}
							},
							"microsoft": {
								"language": "sparksql"
							},
							"collapsed": false
						},
						"source": [
							"%%sql\r\n",
							"\r\n",
							"SELECT * FROM NYCTripSmall LIMIT 100"
						],
						"outputs": [],
						"execution_count": 7
					},
					{
						"cell_type": "code",
						"metadata": {
							"jupyter": {
								"source_hidden": false,
								"outputs_hidden": false
							},
							"nteract": {
								"transient": {
									"deleting": false
								}
							},
							"collapsed": true
						},
						"source": [
							"topPurchases = (profitByDateProduct.select('DateID','PaymentType','(sum)TotalAmount')\r\n",
							"    .orderBy('DateID'))\r\n",
							"\r\n",
							"topPurchases.show(100)"
						],
						"outputs": [],
						"execution_count": 14
					},
					{
						"cell_type": "code",
						"metadata": {
							"jupyter": {
								"source_hidden": false,
								"outputs_hidden": false
							},
							"nteract": {
								"transient": {
									"deleting": false
								}
							},
							"collapsed": false
						},
						"source": [
							"sortedTopPurchases = (topPurchases\r\n",
							"    .orderBy( col(\"(sum)TotalAmount\").desc() ))\r\n",
							"\r\n",
							"display(sortedTopPurchases.limit(100))"
						],
						"outputs": [],
						"execution_count": 15
					},
					{
						"cell_type": "code",
						"metadata": {
							"jupyter": {
								"source_hidden": false,
								"outputs_hidden": false
							},
							"nteract": {
								"transient": {
									"deleting": false
								}
							},
							"collapsed": false
						},
						"source": [
							"groupedTopPurchases = (topPurchases.select(\"DateId\",\"(sum)TotalAmount\")\r\n",
							"    .groupBy(\"DateId\")\r\n",
							"    .agg(sum(\"(sum)TotalAmount\").alias(\"totalAmount\"))\r\n",
							"    .orderBy(\"DateId\") )\r\n",
							"\r\n",
							"display(groupedTopPurchases.limit(100))"
						],
						"outputs": [],
						"execution_count": 21
					}
				]
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('workspaceName'), '/Notebook 1')]",
			"type": "Microsoft.Synapse/workspaces/notebooks",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"nbformat": 4,
				"nbformat_minor": 2,
				"bigDataPool": {
					"referenceName": "Sparkpool01",
					"type": "BigDataPoolReference"
				},
				"sessionProperties": {
					"driverMemory": "28g",
					"driverCores": 4,
					"executorMemory": "28g",
					"executorCores": 4,
					"numExecutors": 2,
					"conf": {
						"spark.dynamicAllocation.enabled": "false",
						"spark.dynamicAllocation.minExecutors": "2",
						"spark.dynamicAllocation.maxExecutors": "2"
					}
				},
				"metadata": {
					"saveOutput": true,
					"synapse_widget": {
						"version": "0.1"
					},
					"kernelspec": {
						"name": "synapse_pyspark",
						"display_name": "Synapse PySpark"
					},
					"language_info": {
						"name": "python"
					},
					"a365ComputeOptions": {
						"id": "/subscriptions/8759debb-3921-4c79-904d-c0e86b64d530/resourceGroups/zxctest01/providers/Microsoft.Synapse/workspaces/asatest02/bigDataPools/Sparkpool01",
						"name": "Sparkpool01",
						"type": "Spark",
						"endpoint": "https://asatest02.dev.azuresynapse.net/livyApi/versions/2019-11-01-preview/sparkPools/Sparkpool01",
						"auth": {
							"type": "AAD",
							"authResource": "https://dev.azuresynapse.net"
						},
						"sparkVersion": "2.4",
						"nodeCount": 3,
						"cores": 4,
						"memory": 28
					}
				},
				"cells": [
					{
						"cell_type": "code",
						"source": [
							"new_rows = [('CA',22, 45000),(\"WA\",35,65000) ,(\"WA\",50,85000)]\r\n",
							"demo_df = spark.createDataFrame(new_rows, ['state', 'age', 'salary'])\r\n",
							"demo_df.show()"
						],
						"outputs": [],
						"execution_count": 1
					},
					{
						"cell_type": "code",
						"metadata": {
							"jupyter": {
								"source_hidden": false,
								"outputs_hidden": false
							},
							"nteract": {
								"transient": {
									"deleting": false
								}
							},
							"collapsed": true
						},
						"source": [
							"from pyspark.sql import SparkSession\r\n",
							"from pyspark.sql.types import *\r\n",
							"account_name = \"adltest02\"\r\n",
							"container_name = \"source\"\r\n",
							"relative_path = \"Test01\"\r\n",
							"adls_path = 'abfss://%s@%s.dfs.core.windows.net/%s' % (container_name, account_name, relative_path)\r\n",
							"\r\n",
							"spark.conf.set(\"fs.azure.account.auth.type.%s.dfs.core.windows.net\" %account_name, \"SharedKey\")\r\n",
							"spark.conf.set(\"fs.azure.account.key.%s.dfs.core.windows.net\" %account_name ,\"fpyE8GOCY7uzj3VwfI3MJg2vGG0UaGvGCEzv9LqsMBUion3xWDelEMXG9TeBYbPF75qP/7XL+oyV39MwGmUl4A==\")\r\n",
							"\r\n",
							"df1 = spark.read.option('header', 'true') \\\r\n",
							"                .option('delimiter', ',') \\\r\n",
							"                .csv(adls_path + '/Products.csv')"
						],
						"outputs": [],
						"execution_count": 3
					},
					{
						"cell_type": "code",
						"metadata": {
							"jupyter": {
								"source_hidden": false,
								"outputs_hidden": false
							},
							"nteract": {
								"transient": {
									"deleting": false
								}
							},
							"collapsed": true
						},
						"source": [
							"df1.show()"
						],
						"outputs": [],
						"execution_count": 4
					}
				]
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('workspaceName'), '/Notebook NYC Taxi')]",
			"type": "Microsoft.Synapse/workspaces/notebooks",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"nbformat": 4,
				"nbformat_minor": 2,
				"bigDataPool": {
					"referenceName": "Sparkpool01",
					"type": "BigDataPoolReference"
				},
				"sessionProperties": {
					"driverMemory": "28g",
					"driverCores": 4,
					"executorMemory": "28g",
					"executorCores": 4,
					"numExecutors": 2,
					"conf": {
						"spark.dynamicAllocation.enabled": "false",
						"spark.dynamicAllocation.minExecutors": "2",
						"spark.dynamicAllocation.maxExecutors": "2"
					}
				},
				"metadata": {
					"saveOutput": true,
					"synapse_widget": {
						"version": "0.1",
						"state": {
							"cec4ff72-ce2b-41f7-9d8c-4725559dbef8": {
								"type": "Synapse.DataFrame",
								"sync_state": {
									"table": {
										"rows": [
											{
												"PassengerCount": 1,
												"SumTripDistance": 190167.33999999636,
												"AvgTripDistance": 2.8735733929704184
											},
											{
												"PassengerCount": 2,
												"SumTripDistance": 49399.7400000001,
												"AvgTripDistance": 3.130726915520635
											},
											{
												"PassengerCount": 3,
												"SumTripDistance": 14790.389999999987,
												"AvgTripDistance": 2.884803978935047
											},
											{
												"PassengerCount": 4,
												"SumTripDistance": 8558.350000000004,
												"AvgTripDistance": 2.9976707530648
											},
											{
												"PassengerCount": 5,
												"SumTripDistance": 17187.240000000013,
												"AvgTripDistance": 2.8550232558139554
											},
											{
												"PassengerCount": 6,
												"SumTripDistance": 10741.91,
												"AvgTripDistance": 2.8798686327077747
											}
										],
										"schema": {
											"PassengerCount": "int",
											"SumTripDistance": "double",
											"AvgTripDistance": "double"
										}
									},
									"isSummary": false,
									"language": "scala"
								},
								"persist_state": {
									"view": {
										"type": "details",
										"chartOptions": {
											"chartType": "bar",
											"aggregationType": "sum",
											"categoryFieldKeys": [
												"SumTripDistance"
											],
											"seriesFieldKeys": [
												"PassengerCount"
											],
											"isStacked": false
										}
									}
								}
							}
						}
					},
					"kernelspec": {
						"name": "synapse_pyspark",
						"display_name": "Synapse PySpark"
					},
					"language_info": {
						"name": "python"
					},
					"a365ComputeOptions": {
						"id": "/subscriptions/8759debb-3921-4c79-904d-c0e86b64d530/resourceGroups/zxctest01/providers/Microsoft.Synapse/workspaces/asatest02/bigDataPools/Sparkpool01",
						"name": "Sparkpool01",
						"type": "Spark",
						"endpoint": "https://asatest02.dev.azuresynapse.net/livyApi/versions/2019-11-01-preview/sparkPools/Sparkpool01",
						"auth": {
							"type": "AAD",
							"authResource": "https://dev.azuresynapse.net"
						},
						"sparkVersion": "2.4",
						"nodeCount": 3,
						"cores": 4,
						"memory": 28
					}
				},
				"cells": [
					{
						"cell_type": "code",
						"metadata": {
							"microsoft": {
								"language": "python"
							},
							"collapsed": false
						},
						"source": [
							"%%pyspark\r\n",
							"df = spark.read.load('abfss://myworkspace@adltest02.dfs.core.windows.net/NYCTripSmall.parquet', format='parquet')\r\n",
							"display(df.limit(10))"
						],
						"outputs": [],
						"execution_count": 1
					},
					{
						"cell_type": "code",
						"metadata": {
							"jupyter": {
								"source_hidden": false,
								"outputs_hidden": false
							},
							"nteract": {
								"transient": {
									"deleting": false
								}
							},
							"microsoft": {
								"language": "python"
							},
							"collapsed": true
						},
						"source": [
							"%%pyspark\r\n",
							"spark.sql(\"CREATE DATABASE IF NOT EXISTS nyctaxi\")\r\n",
							"df.write.mode(\"overwrite\").saveAsTable(\"nyctaxi.trip\")"
						],
						"outputs": [],
						"execution_count": 2
					},
					{
						"cell_type": "code",
						"metadata": {
							"jupyter": {
								"source_hidden": false,
								"outputs_hidden": false
							},
							"nteract": {
								"transient": {
									"deleting": false
								}
							},
							"microsoft": {
								"language": "python"
							},
							"collapsed": false
						},
						"source": [
							"%%pyspark\r\n",
							"df = spark.sql(\"SELECT * FROM nyctaxi.trip\") \r\n",
							"display(df)"
						],
						"outputs": [],
						"execution_count": 3
					},
					{
						"cell_type": "code",
						"metadata": {
							"jupyter": {
								"source_hidden": false,
								"outputs_hidden": false
							},
							"nteract": {
								"transient": {
									"deleting": false
								}
							},
							"microsoft": {
								"language": "python"
							},
							"collapsed": false
						},
						"source": [
							"%%pyspark\r\n",
							"df = spark.sql(\"\"\"\r\n",
							"   SELECT PassengerCount,\r\n",
							"       SUM(TripDistanceMiles) as SumTripDistance,\r\n",
							"       AVG(TripDistanceMiles) as AvgTripDistance\r\n",
							"   FROM nyctaxi.trip\r\n",
							"   WHERE TripDistanceMiles > 0 AND PassengerCount > 0\r\n",
							"   GROUP BY PassengerCount\r\n",
							"   ORDER BY PassengerCount\r\n",
							"\"\"\") \r\n",
							"display(df)\r\n",
							"#df.write.mode(SaveMode.Overwrite).saveAsTable(\"nyctaxi.passengercountstats\")"
						],
						"outputs": [],
						"execution_count": 1
					}
				]
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('workspaceName'), '/dwtest01')]",
			"type": "Microsoft.Synapse/workspaces/sqlPools",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"collation": "SQL_Latin1_General_CP1_CI_AS",
				"maxSizeBytes": 263882790666240,
				"restorePointInTime": "0001-01-01T00:00:00",
				"annotations": []
			},
			"dependsOn": [],
			"location": "eastus"
		}
	]
}